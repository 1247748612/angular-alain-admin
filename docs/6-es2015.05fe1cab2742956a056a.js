(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{Z0ed:function(e,t,n){"use strict";n.r(t),n.d(t,"SettingModule",(function(){return Pe}));var i=n("PCNd"),s=n("ok2U"),c=n("fXoL"),o=n("dEAy"),a=n("Ac7g"),r=n("qAZ0"),l=n("OzZK"),d=n("RwU8"),u=n("C2AL");let h=(()=>{class e{constructor(e,t){this.modal=e,this.http=t,this.ui={},this._formData={}}ngOnInit(){this.value&&Object.keys(this.schema.properties).forEach(e=>this._formData[e]=this.value[e])}ngAfterViewInit(){}save(e){console.log(e,this.event,"save"),this.event&&this.event(e,this.close.bind(this))}close(){this.modal.destroy()}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(o.b),c.Tb(a.r))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-crud-from"]],viewQuery:function(e,t){var n;1&e&&c.Tc(s.b,!0),2&e&&c.Ac(n=c.ic())&&(t.sf=n.first)},inputs:{schema:"schema",ui:"ui",mode:"mode",value:"value",event:"event"},decls:13,vars:7,consts:[[1,"modal-header"],[1,"modal-title"],["nzTip","\u62fc\u547d\u52a0\u8f7d\u4e2d","nzSize","large",1,"modal-spin",3,"nzSpinning"],["mode","edit","button","none",3,"schema","ui","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(e,t){if(1&e){const e=c.ac();c.Zb(0,"div",0),c.Zb(1,"div",1),c.Oc(2),c.Yb(),c.Yb(),c.Zb(3,"nz-spin",2),c.Zb(4,"sf",3,4),c.Zb(6,"div",5),c.Zb(7,"button",6),c.hc("click",(function(){return t.close()})),c.Oc(8,"\u5173\u95ed"),c.Yb(),c.Zb(9,"button",6),c.hc("click",(function(){return c.Ec(e),c.Bc(5).reset(!0)})),c.Oc(10,"\u91cd\u7f6e"),c.Yb(),c.Zb(11,"button",7),c.hc("click",(function(){c.Ec(e);const n=c.Bc(5);return t.save(n.value)})),c.Oc(12,"\u4fdd\u5b58"),c.Yb(),c.Yb(),c.Yb(),c.Yb()}if(2&e){const e=c.Bc(5);c.Db(2),c.Qc("","add"===t.mode?"\u65b0\u589e":"\u7f16\u8f91","\u4fe1\u606f"),c.Db(1),c.sc("nzSpinning",t.http.loading),c.Db(1),c.sc("schema",t.schema)("ui",t.ui)("formData",t._formData),c.Db(7),c.sc("disabled",!e.valid)("nzLoading",t.http.loading)}},directives:[r.a,s.b,l.a,d.a,u.a],encapsulation:2}),e})(),p=(()=>{class e{constructor(){this.buttons=[]}get topButtons(){return this.buttons}addButton(e){this.buttons.push(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac}),e})(),b=(()=>{class e{constructor(e,t){this.tRef=e,this.crudTopButton=t}ngOnInit(){this.crudTopButton.addButton(this.tRef)}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(c.M,8),c.Tb(p))},e.\u0275dir=c.Ob({type:e,selectors:[["","crud-top-button",""]]}),e})(),m=(()=>{class e{constructor(){this.titles={},this.rows={}}get titleKeys(){return Object.keys(this.titles)}get rowKeys(){return Object.keys(this.rows)}addTitle(e,t){return this.titles[e]=t}addRow(e,t){return this.rows[e]=t}getTitle(e){return this.titles[e]}getRow(e){return this.rows[e]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),g=(()=>{class e{constructor(e,t){this.ref=e,this.source=t}set row(e){this.source.addRow(e,this.ref)}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(c.M),c.Tb(m))},e.\u0275dir=c.Ob({type:e,selectors:[["","crud-row",""]],inputs:{row:["crud-row","row"]}}),e})();var f=n("3E0/"),y=n("vkgz"),v=n("JIr8");let x=(()=>{class e{constructor(e,t,n,i){this.crudTemplateRef=e,this.modelHelper=t,this.http=n,this.modalService=i,this._formData={},this.schema={properties:{},ui:{grid:{xs:24,sm:24,md:24,lg:12,xl:12},"*":{spanLabel:4,spanControl:20}},required:[]},this.tableAction={title:"\u64cd\u4f5c",fixed:"right",width:150,fromHidden:!1,iif:()=>this.tableActionIif,buttons:[{text:"\u7f16\u8f91",icon:"edit",prefix:"edit",iif:()=>!1!==this.event.edit&&this.editIif,click:e=>{this._data=e,this.openModelForm("edit",e)}},{text:"\u5220\u9664",icon:"delete",type:"del",prefix:"del",iif:()=>!1!==this.event.del&&this.delIif,click:e=>{console.log("\u5220\u9664\u65f6\u4f20\u6765\u7684\u53c2\u6570",e),this.handleDelete(e)}}]},this.defaultSchemaUi={placeholder:""}}get tableActionIif(){return 2!==this.tableAction.buttons.length||this.event&&(this.event.add||this.event.edit||this.baseUrl)}get addIif(){return this.event.add||this.baseUrl}get editIif(){return this.event.edit||this.baseUrl}get delIif(){return this.event.del||this.baseUrl}set event(e){this._event=e,e&&(this.baseUrl=e.url)}get event(){return this._event}getReqOptions(e,t,n){return Object.assign({url:e.url||this.baseUrl,method:e.method||t,data:e.reData?e.reData({columnData:this._data,fromData:n}):n},e.reReq?e.reReq({columnData:this._data,fromData:n}):{})}handleAdd(e,t){const n=this.event.add||{};if(n instanceof Function)return void n(e,t);const i=this.getReqOptions(n,"post",e),s=Object.assign(Object.assign({},this.event.options),n.options);this.customHttp(i,Object.assign(Object.assign({},s),{loading:t}))}handleEdit(e,t){const n=this.event.edit||{};if(n instanceof Function)return void n(this._data,e,t);const i=this.getReqOptions(n,"put",e),s=Object.assign(Object.assign({},this.event.options),n.options);this.customHttp(i,Object.assign(Object.assign({},s),{loading:t}))}handleDelete(e){const t=this.event.del||{};if(t instanceof Function)return void t(e);const n=this.getReqOptions(t,"delete",e),i=Object.assign(Object.assign({},this.event.options),t.options);this.customHttp(n,i)}customHttp(e,t={}){this.http.request(e.method,e.url,{body:"get"===e.method?{}:e.data,params:"get"===e.method?e.data:{}}).pipe(Object(f.a)(300),Object(y.a)(()=>{t.loading&&t.loading()}),Object(v.a)(t.errorCallback||(e=>{this.errorCallback(e,t)}))).subscribe(t.successCallback||(e=>{this.successCallback(e,t)}))}errorCallback(e,t){t&&t.loading instanceof Function&&t.loading(),console.log(e,arguments,"\u770b\u770b\u9519\u8bef\u56de\u8c03")}successCallback(e,t){t&&t.loading instanceof Function&&t.loading(),console.log(e,arguments,"\u770b\u770b\u6210\u529f\u56de\u8c03")}columnsInit(e){const t=[];return e.forEach(e=>{t.push(Object.assign(Object.assign({},e),{__render:this.crudTemplateRef.getRow(e.render),__renderTitle:this.crudTemplateRef.getTitle(e.renderTitle)}))}),console.log(t),t}getPropertiesName(e){return e.index?e.index instanceof Array?e.index[e.index.length-1]:e.index:e.render?e.render:void 0}getSchema(e="add"){const t=JSON.parse(JSON.stringify(this.schema));return this.columns.forEach(n=>{var i;if(n.fromHidden)return;if("add"===e&&!0===n.fromAddHidden)return;if("edit"===e&&!0===n.fromEditHidden)return;const s=this.getPropertiesName(n),c=(null===(i=n.title)||void 0===i?void 0:i.text)||n.title||n.renderTitle;this.defaultSchemaUi.placeholder="\u8bf7\u8f93\u5165 "+c,n.required&&t.required.push(s),t.properties[s]=Object.assign({title:c,type:"string",ui:this.defaultSchemaUi},n.schema),n.schema&&(console.log(n.schema,"readOnly",Reflect.has(n.schema,"addReadOnly")),Reflect.has(n.schema,"readOnly")?t.properties[s].readOnly=n.schema.readOnly:"edit"===e&&Reflect.has(n.schema,"editReadOnly")?t.properties[s].readOnly=n.schema.editReadOnly:"add"===e&&Reflect.has(n.schema,"addReadOnly")&&(t.properties[s].readOnly=n.schema.addReadOnly),console.log(t.properties[s],"rado"));const o=t.properties[s].ui;t.properties[s].ui=Object.assign(Object.assign({},this.defaultSchemaUi),o)}),{schema:t}}openModelForm(e,t){const{schema:n}=this.getSchema(e);this.modelHelper.static(h,{schema:n,value:t,mode:e,event:("edit"===e?this.handleEdit:this.handleAdd).bind(this)},"lg",{nzKeyboard:!1}).subscribe(e=>{console.log(e)})}changeColumns(e){const t=[],n=[];e.forEach(e=>{var i;n.push({key:e.index||e.render,title:(null===(i=e.title)||void 0===i?void 0:i.text)||e.title||e.renderTitle,direction:!1===e.show?"left":"right"}),t.push(Object.assign(Object.assign({},e),{iif:(...t)=>{const n=t[0];return e.iif?!1!==n.show&&e.iif(...t):!1!==n.show}}))}),console.log(this.event);const i=Object.assign(Object.assign({},this.tableAction),{buttons:this.tableAction.buttons.map(e=>{const t=this.event[e.prefix+"Ability"];return Object.assign(Object.assign({},e),{acl:t?{ability:[t]}:null})})});return console.log(i,"acl tableAction"),t.push(i),this.columns=e,{columns:t,transferData:n}}}return e.\u0275fac=function(t){return new(t||e)(c.dc(m),c.dc(a.j),c.dc(a.r),c.dc(o.c))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac}),e})();var T=n("PScX"),z=n("ofXK"),k=n("Nqz0"),O=n("FwiY"),_=n("Q8cG"),D=n("F6ss"),w=n("GuFl"),C=n("DGaY"),A=n("atJ9");const I=["st"];function S(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",22),c.hc("click",(function(){return c.Ec(e),c.kc(2).topAddBtn("add")})),c.Ub(1,"i",23),c.Oc(2,"\u65b0\u589e"),c.Yb()}if(2&e){const e=c.kc(2);c.sc("acl-ability",e.event.addAbility)}}function j(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",24),c.hc("click",(function(){return c.Ec(e),c.kc(2).topEditBtn("edit")})),c.Ub(1,"i",25),c.Oc(2,"\u7f16\u8f91"),c.Yb()}if(2&e){const e=c.kc(2);c.sc("disabled",e.topEditBtnDisabled)("acl-ability",e.event.editAbility)}}function M(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",26),c.hc("click",(function(){return c.Ec(e),c.kc(2).topDelBtn()})),c.Ub(1,"i",27),c.Oc(2,"\u5220\u9664"),c.Yb()}if(2&e){const e=c.kc(2);c.sc("disabled",e.topDelBtnDisabled)("acl-ability",e.event.delAbility)}}function Z(e,t){if(1&e&&(c.Xb(0),c.Mc(1,S,3,1,"button",19),c.Mc(2,j,3,2,"button",20),c.Mc(3,M,3,2,"button",21),c.Wb()),2&e){const e=c.kc();c.Db(1),c.sc("ngIf",e.addIif),c.Db(1),c.sc("ngIf",e.editIif),c.Db(1),c.sc("ngIf",e.delIif)}}function Y(e,t){}const E=function(e){return{$implicit:e}};function H(e,t){if(1&e&&c.Mc(0,Y,0,0,"ng-template",28),2&e){const e=t.$implicit,n=c.kc();c.sc("ngTemplateOutlet",e)("ngTemplateOutletContext",c.wc(2,E,n.topButtonsContext))}}function R(e,t){}const P=function(e,t,n){return{$implicit:e,index:t,column:n}};function B(e,t){if(1&e&&c.Mc(0,R,0,0,"ng-template",28),2&e){const e=t.$implicit,n=t.index,i=t.column,s=c.kc(2).$implicit;c.sc("ngTemplateOutlet",s.__render)("ngTemplateOutletContext",c.yc(2,P,e,n,i))}}function L(e,t){if(1&e&&(c.Xb(0),c.Mc(1,B,1,6,"ng-template",29),c.Wb()),2&e){const e=c.kc().$implicit;c.Db(1),c.sc("st-row",e.render)}}function F(e,t){}const U=function(e,t){return{$implicit:e,index:t}};function q(e,t){if(1&e&&c.Mc(0,F,0,0,"ng-template",28),2&e){const e=t.$implicit,n=t.index,i=c.kc(2).$implicit;c.sc("ngTemplateOutlet",i.__renderTitle)("ngTemplateOutletContext",c.xc(2,U,e,n))}}function N(e,t){if(1&e&&(c.Xb(0),c.Mc(1,q,1,5,"ng-template",30),c.Wb()),2&e){const e=c.kc().$implicit;c.Db(1),c.sc("st-row",e.renderTitle)}}function $(e,t){if(1&e&&(c.Xb(0),c.Mc(1,L,2,1,"ng-container",2),c.Mc(2,N,2,1,"ng-container",2),c.Wb()),2&e){const e=t.$implicit;c.Db(1),c.sc("ngIf",e.__render),c.Db(1),c.sc("ngIf",e.__renderTitle)}}const Q=function(){return{"height.vh":40}},G=function(){return["\u9690\u85cf","\u5c55\u793a"]};let J=(()=>{class e{constructor(e,t,n,i,s){this.crudService=e,this.modalService=t,this.messageService=n,this.crudTopButton=i,this.viewContainer=s,this._formData={},this.crudChange=new c.n,this.scroll={x:"100vw",y:"70vh"},this.usePagination=!0,this._event=null,this.total=0,this.page={front:!1,show:!0,showQuickJumper:!0,placement:"center"},this.req={reName:{pi:"page",ps:"limit"}},this.res={process:(e,t)=>"object"==typeof this.data?t:(this.total=this.usePagination?t.data.pagination.total:0,this.usePagination?t.data.data:t.data)},this.visible=!1,this.transferDataSource=[]}set formData(e){this._formData=e||{},this.crudService._formData=e||{}}get formData(){return this._formData}set tableAction(e){e&&(this.crudService.tableAction=Object.assign(Object.assign(Object.assign({},this.crudService.tableAction),e),{buttons:[...this.crudService.tableAction.buttons,...e.buttons]}),console.log(this.crudService.tableAction,"tableAction"),this.crudService.columnsInit(this.columns))}set schema(e){this.crudService.schema=Object.assign(Object.assign({},this.crudService.schema),e)}set columns(e){this._columns=e}get columns(){return this._columns}set event(e){this._event=e,this.crudService.event=e}get event(){return this._event}get topButtonsContext(){return{radio:this._radio,checkbox:this._checkbox,changeType:this._stChangeType}}get topButtons(){return this.crudTopButton.topButtons}get tableActionIif(){return this.crudService.tableActionIif&&(!1!==this.event.topEdit||!1!==this.event.topDel||!1!==this.event.topAdd)}get editIif(){return!1!==this.event.topEdit&&this.crudService.editIif}get delIif(){return!1!==this.event.topDel&&this.crudService.delIif}get addIif(){return!1!==this.event.topAdd&&this.crudService.addIif}ngOnChanges({columns:e}){if(e&&e.currentValue){const t=this.crudService.changeColumns(e.currentValue);console.log(e.currentValue,t,"\u6709\u65e0\u66f4\u65b0"),this.columns=t.columns,this.transferDataSource=t.transferData}}stChange(e){switch(this.crudChange.emit(e),e.type){case"radio":return this._stChangeType=e.type,void(this._radio=e.radio);case"checkbox":return this._stChangeType=e.type,void(this._checkbox=e.checkbox)}}get topEditBtnDisabled(){if("radio"===this._stChangeType){if(!this._radio)return!0}else{if("checkbox"!==this._stChangeType)return!0;if(1!==this._checkbox.length)return!0}return!1}topEditBtn(e){const t=this._checkbox;"radio"===this._stChangeType?this.crudService._data=this._radio:"checkbox"===this._stChangeType&&(this.crudService._data=t[0]),this.crudService.openModelForm(e,t[0])}get topDelBtnDisabled(){return!this._stChangeType||"checkbox"===this._stChangeType&&!this._checkbox.length||"radio"===this._stChangeType&&!this._radio}topDelBtn(){this.modalService.confirm({nzTitle:"\u786e\u8ba4\u5220\u9664\uff1f",nzContent:'<b style="color: red;">\u4f60\u662f\u5426\u786e\u5b9a\u8981\u5220\u9664\u52fe\u9009\u7684\u5168\u90e8\u6570\u636e\uff1f</b>',nzOkText:"\u5220\u9664",nzOkType:"danger",nzCancelText:"\u53d6\u6d88",nzOnOk:()=>{this.crudService.handleDelete(this["_"+this._stChangeType])},nzOnCancel:()=>console.log("Cancel")})}topAddBtn(e){console.log(this.formData),this.crudService.openModelForm(e,this.formData)}ngOnInit(){console.log(this.data,"init"),this.columns=this.crudService.columnsInit(this.columns)}open(){this.visible=!0}close(){this.visible=!1}load(...e){this._checkbox=[],this._radio={},this._stChangeType="",this.st.load(...e)}transferChange(e){const t=e.list.map(e=>e.key);this.columns=this.columns.map(e=>t.includes(e.index)||t.includes(e.render)?Object.assign(Object.assign({},e),{show:!1===e.show}):e)}ngAfterViewInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(x),c.Tb(o.c),c.Tb(T.e),c.Tb(p),c.Tb(c.Q))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-crud"]],viewQuery:function(e,t){var n;1&e&&c.Tc(I,!0),2&e&&c.Ac(n=c.ic())&&(t.st=n.first)},inputs:{formData:"formData",tableAction:"tableAction",scroll:"scroll",schema:"schema",columns:"columns",data:"data",usePagination:"usePagination",event:"event"},outputs:{crudChange:"change"},features:[c.Cb([x,m,p]),c.Bb],decls:32,vars:19,consts:[[1,"header-wrapper","d-flex","justify-content-around","rounded-lg","py-md","px-sm","bg-white","border"],[1,"left","d-flex","justify-content-start","flex-1"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"right","d-flex","justify-content-end","flex-1"],["topRight",""],["nz-dropdown","","nz-button","","nzType","primary","nzShape","round",3,"nzDropdownMenu"],["nz-icon","","nzType","down"],["menu","nzDropdownMenu"],["nz-menu","","nzSelectable",""],["nz-menu-item",""],["nz-button","","nzType","primary","nzDanger","",3,"click"],["nz-button","","nzType","primary","nzShape","round",3,"click"],["nz-icon","","nzType","reload"],["nz-icon","","nzType","one-to-one"],["nzPlacement","right","nzTitle","\u663e\u9690\u8868\u683c\u5217",3,"nzClosable","nzVisible","nzOnClose"],[3,"nzListStyle","nzDataSource","nzTitles","nzChange"],[3,"loadingDelay","data","columns","req","res","page","total","scroll","change"],["st",""],["acl","","nz-button","","nzType","primary",3,"acl-ability","click",4,"ngIf"],["acl","","nz-button","","nzType","primary","nzGhost","",3,"disabled","acl-ability","click",4,"ngIf"],["acl","","nz-button","","nzType","primary","nzDanger","",3,"disabled","acl-ability","click",4,"ngIf"],["acl","","nz-button","","nzType","primary",3,"acl-ability","click"],["nz-icon","","nzType","plus"],["acl","","nz-button","","nzType","primary","nzGhost","",3,"disabled","acl-ability","click"],["nz-icon","","nzType","edit"],["acl","","nz-button","","nzType","primary","nzDanger","",3,"disabled","acl-ability","click"],["nz-icon","","nzType","delete"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"st-row"],["type","title",3,"st-row"]],template:function(e,t){if(1&e){const e=c.ac();c.Zb(0,"div",0),c.Zb(1,"div",1),c.Mc(2,Z,4,3,"ng-container",2),c.Mc(3,H,1,4,void 0,3),c.Yb(),c.Zb(4,"div",4,5),c.Zb(6,"button",6),c.Ub(7,"i",7),c.Yb(),c.Zb(8,"nz-dropdown-menu",null,8),c.Zb(10,"ul",9),c.Zb(11,"li",10),c.Zb(12,"button",11),c.hc("click",(function(){return c.Ec(e),c.Bc(30).clear()})),c.Oc(13,"\u6570\u636e"),c.Yb(),c.Yb(),c.Zb(14,"li",10),c.Zb(15,"button",11),c.hc("click",(function(){return c.Ec(e),c.Bc(30).clearStatus(),t.load()})),c.Oc(16,"\u6240\u6709\u72b6\u6001"),c.Yb(),c.Yb(),c.Zb(17,"li",10),c.Zb(18,"button",11),c.hc("click",(function(){return c.Ec(e),c.Bc(30).clearCheck()})),c.Oc(19,"\u591a\u9009\u6309\u94ae"),c.Yb(),c.Yb(),c.Zb(20,"li",10),c.Zb(21,"button",11),c.hc("click",(function(){return c.Ec(e),c.Bc(30).clearRadio()})),c.Oc(22,"\u5355\u9009\u6309\u94ae"),c.Yb(),c.Yb(),c.Yb(),c.Yb(),c.Zb(23,"button",12),c.hc("click",(function(){return c.Ec(e),c.Bc(30).reload()})),c.Ub(24,"i",13),c.Yb(),c.Zb(25,"button",12),c.hc("click",(function(){return t.open()})),c.Ub(26,"i",14),c.Yb(),c.Yb(),c.Zb(27,"nz-drawer",15),c.hc("nzOnClose",(function(){return t.close()})),c.Zb(28,"nz-transfer",16),c.hc("nzChange",(function(e){return t.transferChange(e)})),c.Yb(),c.Yb(),c.Yb(),c.Zb(29,"st",17,18),c.hc("change",(function(e){return t.stChange(e)})),c.Mc(31,$,3,2,"ng-container",3),c.Yb()}if(2&e){const e=c.Bc(9);c.Db(2),c.sc("ngIf",t.event),c.Db(1),c.sc("ngForOf",t.topButtons),c.Db(3),c.sc("nzDropdownMenu",e),c.Db(21),c.sc("nzClosable",!1)("nzVisible",t.visible),c.Db(1),c.sc("nzListStyle",c.vc(17,Q))("nzDataSource",t.transferDataSource)("nzTitles",c.vc(18,G)),c.Db(1),c.sc("loadingDelay",t.loadingDelay)("data",t.data)("columns",t.columns)("req",t.req)("res",t.res)("page",t.page)("total",t.total)("scroll",t.scroll),c.Db(2),c.sc("ngForOf",t.columns)}},directives:[z.m,z.l,l.a,d.a,k.b,u.a,k.d,O.a,k.e,_.c,_.e,D.a,w.a,C.a,A.a,z.r,C.c],styles:["nz-select[_ngcontent-%COMP%] {\n        width: 120px;\n      }\n\n      nz-icon[_ngcontent-%COMP%] {\n        font-size: 24px;\n      }"]}),e})(),V=(()=>{class e{constructor(){}}return e.\u0275mod=c.Rb({type:e}),e.\u0275inj=c.Qb({factory:function(t){return new(t||e)},imports:[[i.a],i.a]}),e})();var W=n("LRne");const X=["crud"];function K(e,t){if(1&e&&c.Oc(0),2&e){const e=c.kc();c.Qc(" ",e.dictionaryType.name," ")}}let ee=(()=>{class e{constructor(){this.dictionaryType={_id:"",name:""},this._url="/dictionary/type/",this.usePagination=!1,this.event={url:"/dictionary",addAbility:"dictionary_add",editAbility:"dictionary_edit",delAbility:"dictionary_del",options:{successCallback:()=>{this.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:()=>{console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:({columnData:e})=>(console.log(e),{url:`${this.event.url}/${e.name}`})},del:{reData:({fromData:e})=>{console.log(e);const t=[];return e instanceof Array?e.forEach(e=>t.push(e._id)):t.push(e._id),{dictionaryTypeIds:t}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u5b57\u5178\u7c7b\u578b\u540d",render:"typeId",schema:{title:"\u5b57\u5178\u7c7b\u578bid",readOnly:!0,ui:{widget:"select",spanLabelFixed:100,grid:{span:24,spanLabelFixed:100},asyncData:()=>Object(W.a)(this.selectOption)}},required:!0},{title:"\u6807\u7b7e",index:"label",required:!0},{title:"\u503c",index:"value",required:!0},{title:"\u63cf\u8ff0",index:"description"},{type:"date",index:"createdAt",title:"\u521b\u5efa\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0}]}get formData(){return{typeId:this.dictionaryType._id}}get url(){return this._url+this.dictionaryType.name}get selectOption(){return[{label:this.dictionaryType.name,value:this.dictionaryType._id}]}crudChange(e){console.log(e,"crudChange")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Nb({type:e,selectors:[["app-dictionary"]],viewQuery:function(e,t){var n;1&e&&c.Tc(X,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},inputs:{dictionaryType:"dictionaryType"},decls:3,vars:5,consts:[[3,"columns","data","event","usePagination","formData"],["crud",""],["crud-row","typeName"]],template:function(e,t){1&e&&(c.Zb(0,"app-crud",0,1),c.Mc(2,K,1,1,"ng-template",2),c.Yb()),2&e&&c.sc("columns",t.columns)("data",t.url)("event",t.event)("usePagination",t.usePagination)("formData",t.formData)},directives:[J,g],encapsulation:2}),e})();const te=["crud"];let ne=(()=>{class e{constructor(e){this.modalHelper=e,this.url="/dictionary/type/pagination",this.event={url:"/dictionary/type",addAbility:"dictionary_type_add",editAbility:"dictionary_type_edit",delAbility:"dictionary_type_del",options:{successCallback:()=>{this.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:()=>{console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:({columnData:e})=>(console.log(e),{url:"/dictionary/type/"+e._id})},del:{reData({fromData:e}){console.log(e);const t=[];return e instanceof Array?e.forEach(e=>t.push(e._id)):t.push(e._id),{dictionaryTypeIds:t}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u5b57\u5178\u7c7b\u578b\u540d",index:"name",type:"link",click:e=>{this.modalHelper.open(ee,{dictionaryType:e},"xl",{nzTitle:e.name+"\u7684\u5b57\u5178",nzWrapClassName:"vertival-center-modal"}).subscribe()},schema:{ui:{spanLabelFixed:100,grid:{span:24}}},required:!0},{title:"\u8bf4\u660e/\u63cf\u8ff0",index:"description",schema:{ui:{spanLabelFixed:100,grid:{span:24}}}},{type:"date",index:"createdAt",title:"\u521b\u5efa\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0}]}crudChange(e){console.log(e,"crudChange")}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(a.j))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-dictionary-type"]],viewQuery:function(e,t){var n;1&e&&c.Tc(te,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},decls:2,vars:3,consts:[[3,"columns","data","event"],["crud",""]],template:function(e,t){1&e&&c.Ub(0,"app-crud",0,1),2&e&&c.sc("columns",t.columns)("data",t.url)("event",t.event)},directives:[J],styles:[".vertical-center-modal {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n        .vertical-center-modal .ant-modal {\n        top: 0;\n      }"]}),e})();var ie=n("z6cu");let se=(()=>{class e{constructor(e,t){this.http=e,this.messageService=t}deleteLogAll(){return this.http.delete("/logging/all").pipe(Object(v.a)(e=>(console.log("\u5220\u9664\u6240\u6709\u65e5\u5fd7\u5931\u8d25",e),this.messageService.error(e.error||e.errMessage),Object(ie.a)(e))))}}return e.\u0275fac=function(t){return new(t||e)(c.dc(a.r),c.dc(T.e))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ce=["crud"];function oe(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",3),c.hc("click",(function(){return c.Ec(e),c.kc().deleteAllLog()})),c.Ub(1,"i",4),c.Oc(2,"\u5220\u9664\u5168\u90e8\u65e5\u5fd7"),c.Yb()}2&e&&c.sc("acl-ability","logging_del")}let ae=(()=>{class e{constructor(e,t,n){this.logService=e,this.messageService=t,this.modalService=n,this.url="/logging/pagination",this.columns=[{title:"_id",index:"_id",show:!1},{title:"\u6807\u9898",index:"title",filter:{type:"keyword",reName:(e,t)=>({search:"title,url",title:e[0].value})}},{type:"badge",title:"\u7c7b\u578b",index:"type",filter:{multiple:!1,menus:[{text:"\u6b63\u5e38",value:0},{text:"\u5f02\u5e38",value:1}]},badge:{0:{text:"\u6b63\u5e38",color:"success"},1:{text:"\u5f02\u5e38",color:"error"}}},{title:"\u8bbf\u95ee\u5730\u5740",index:"url",filter:{type:"keyword",reName:(e,t)=>({search:"title,url",url:e[0].value})}},{title:"\u8bbf\u95eeip",index:"ip"},{title:"\u7528\u6237\u4fe1\u606f",index:"userId"},{title:"\u8bf7\u6c42\u65b9\u5f0f",index:"method",type:"tag",filter:{multiple:!0,menus:[{text:"GET",value:"GET"},{text:"POST",value:"POST"},{text:"DELETE",value:"DELETE"},{text:"PUT",value:"PUT"},{text:"PATCH",value:"PATCH"}]},tag:{GET:{text:"GET",color:"success"},POST:{text:"POST",color:"blue"},PUT:{text:"PUT",color:"orange"},DELETE:{text:"DELETE",color:"red"},PATCH:{text:"PATCH",color:"gold"}}},{title:"controller\u7c7b\u540d",index:"controllerName"},{title:"\u63a5\u53e3\u65b9\u6cd5\u540d",index:"funcName"},{title:"\u4f20\u9012\u53c2\u6570",index:"body",show:!1},{title:"\u5f02\u5e38\u6808",index:"stack"},{type:"date",index:"createdAt",title:"\u89e6\u53d1\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 H:mm:ss"},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",show:!1,dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 H:mm:ss"}]}deleteAllLog(){this.modalService.confirm({nzTitle:"\u786e\u8ba4\u5220\u9664\uff1f",nzContent:'<b style="color: red;">\u4f60\u786e\u5b9a\u8981\u5220\u9664\u6240\u6709\u65e5\u5fd7\u5417\uff1f\u8bf7\u6ce8\u610f\uff0c\u5220\u9664\u65e5\u5fd7\u8bb0\u5f55\u662f\u4e0d\u4f1a\u88ab\u5220\u9664\u7684\uff01</b>',nzOkText:"\u5220\u9664",nzOkType:"danger",nzCancelText:"\u53d6\u6d88",nzOnOk:()=>{this.logService.deleteLogAll().subscribe(e=>{this.messageService.success(e.message),this.crud.load()})}})}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(se),c.Tb(T.e),c.Tb(o.c))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-log"]],viewQuery:function(e,t){var n;1&e&&c.Tc(ce,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},decls:3,vars:2,consts:[[3,"columns","data"],["crud",""],["crud-top-button",""],["acl","","nz-button","","nzType","primary","nzDanger","",3,"acl-ability","click"],["nz-icon","","nzType","delete","nzTheme","outline"]],template:function(e,t){1&e&&(c.Zb(0,"app-crud",0,1),c.Mc(2,oe,3,1,"ng-template",2),c.Yb()),2&e&&c.sc("columns",t.columns)("data",t.url)},directives:[J,b,l.a,d.a,A.a,u.a,O.a],encapsulation:2}),e})();var re=n("lJxs");function le(e,t){return function e(n){return n.map(n=>{let i=[];n.children&&n.children.length&&(i=JSON.parse(JSON.stringify(n.children)));const s=Object.assign({children:i.length?e(i):null},t(n));return s.children||Reflect.deleteProperty(s,"children"),s})}(e)}let de=(()=>{class e{constructor(e,t){this.http=e,this.messageService=t}handleMenuData(e){return le(e,e=>({title:e.text,key:e._id}))}getAllMenu(){return this.http.get("/user/menu").pipe(Object(re.a)(e=>this.handleMenuData(e.data)))}}return e.\u0275fac=function(t){return new(t||e)(c.dc(a.r),c.dc(T.e))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ue=n("TBCl");const he=["crud"];let pe=(()=>{class e{constructor(t,n,i,s){this.menuService=t,this.modalHelper=n,this.startupService=i,this.modalRef=s,this.url="/user/menu",this.usePagination=!1,this.formData={pid:null},this.event={url:"/menu",addAbility:"menu_add",editAbility:"menu_edit",delAbility:"menu_del",options:{successCallback:()=>{this.crud.load(),this.startupService.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:()=>{console.log("\u9519\u8bef\u56de\u8c03")}},add:{reData:({fromData:e})=>(""===e.pid&&(e.pid=null),e)},edit:{reReq:({columnData:e})=>(console.log(e),{url:"/menu/"+e._id}),reData:({fromData:e})=>(""===e.pid&&(e.pid=null),console.log(e),e)},del:{reData({fromData:e}){console.log(e);const t=[];return e instanceof Array?e.forEach(e=>t.push(e._id)):t.push(e._id),{menuIds:t}}}},this.scroll={y:"70vh",x:"150vw"},this.tableAction={width:230,buttons:[{text:"\u5b50\u83dc\u5355",icon:"menu",iifBehavior:"disabled",click:t=>{this.modalRef&&this.modalRef.close(),this.modalHelper.open(e,{pid:t._id},"xl",{nzTitle:t.text+"\u7684\u5b50\u83dc\u5355",nzWrapClassName:"vertical-center-modal"}).subscribe(e=>{console.log(e,"modal"),this.crud.load()})},tooltip:"ST\u6682\u4e0d\u652f\u6301tree table\u6240\u4ee5\u5148\u7b80\u5355\u5b9e\u73b0 (\u6ca1\u6709\u5b50\u83dc\u5355\u65f6\u7981\u7528)"}]},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u7236\u83dc\u5355",index:"pid",schema:{addReadOnly:null,default:null,ui:{widget:"tree-select",spanLabelFixed:100,allowClear:!0,asyncData:()=>this.menuService.getAllMenu(),grid:{span:24}}}},{title:"\u7c7b\u578b",index:"type",type:"tag",tag:{0:{text:"\u8def\u7531"},1:{text:"\u5916\u94fe"},2:{text:"\u5206\u7ec4"},3:{text:"\u6309\u94ae"}},schema:{type:"string",enum:[{label:"\u8def\u7531",value:0},{label:"\u5916\u94fe",value:1},{label:"\u5206\u7ec4",value:2},{label:"\u6309\u94ae",value:3}],ui:{spanLabel:4,spanControl:20,widget:"radio",grid:{span:24}},default:0}},{title:"\u83dc\u5355\u540d",index:"text",required:!0},{title:"\u8def\u7531",index:"link",required:!0,schema:{ui:{visibleIf:this.visibleIfType(0)}}},{title:"\u5916\u94fe",index:"externalLink",required:!0,schema:{ui:{visibleIf:this.visibleIfType(1),validator:e=>new RegExp("^https?://").test(e)?[]:[{keyword:"required",message:"\u5f00\u5934\u5fc5\u987b\u5305\u542bhttp://\u83b7\u53d6https://"}]}}},{title:"\u6743\u9650\u6807\u8bc6\u7b26",index:"permissionIdentifier",required:!0,schema:{ui:{spanLabelFixed:100,grid:{span:24}}}},{title:"\u56fe\u6807",index:"icon",schema:{ui:{visibleIf:this.visibleIfType([0,1])}}},{title:"\u6392\u5e8f",index:"sort",default:"-",schema:{ui:{visibleIf:this.visibleIfType([0,1,2])},type:"number",default:1}},{title:"\u662f\u5426\u9690\u85cf",index:"hide",type:"yn",yn:{yes:"\u9690\u85cf",no:"\u663e\u793a",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u9690\u85cf",unCheckedChildren:"\u663e\u793a"},default:!1}},{title:"\u662f\u5426\u7981\u7528",index:"disabled",type:"yn",yn:{yes:"\u7981\u7528",no:"\u542f\u7528",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u7981\u7528",unCheckedChildren:"\u542f\u7528"},default:!1}},{title:"\u662f\u5426\u5feb\u6377\u83dc\u5355",index:"shortcut",type:"yn",yn:{yes:"\u662f",no:"\u5426",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u662f",unCheckedChildren:"\u5426"},default:!1}},{title:"\u662f\u5426\u5feb\u6377\u83dc\u5355\u6839",index:"shortcutRoot",type:"yn",yn:{yes:"\u662f",no:"\u5426",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u662f",unCheckedChildren:"\u5426"},default:!1}},{title:"\u662f\u5426\u5141\u8bb8\u590d\u7528",index:"reuse",type:"yn",yn:{yes:"\u662f",no:"\u5426",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType(0),spanLabel:8,spanControl:16,checkedChildren:"\u662f",unCheckedChildren:"\u5426"},default:!1}}],this.schema={}}set pid(e){console.log(e,"pid\u4f20\u5165"),e&&(this._pid=e,this.url="/menu/currentUser/merge/"+e,this.formData.pid=e,this.columns=this.columns.map(t=>!t.schema||t.schema&&void 0===t.schema.addReadOnly?Object.assign({},t):Object.assign(Object.assign({},t),{schema:Object.assign(Object.assign({},t.schema),{addReadOnly:!!e})})))}get pid(){return console.log(this._pid),this._pid}visibleIfType(e){return{type:t=>Array.isArray(e)?e.includes(t):e===t}}notGroup(){return{type:e=>3!==e}}crudChange(e){console.log(e,"crudChange")}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(de),c.Tb(a.j),c.Tb(ue.a),c.Tb(o.b,8))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-menu"]],viewQuery:function(e,t){var n;1&e&&c.Tc(he,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},inputs:{pid:"pid"},decls:2,vars:8,consts:[[3,"usePagination","columns","formData","tableAction","scroll","data","event","schema","change"],["crud",""]],template:function(e,t){1&e&&(c.Zb(0,"app-crud",0,1),c.hc("change",(function(e){return t.crudChange(e)})),c.Yb()),2&e&&c.sc("usePagination",t.usePagination)("columns",t.columns)("formData",t.formData)("tableAction",t.tableAction)("scroll",t.scroll)("data",t.url)("event",t.event)("schema",t.schema)},directives:[J],styles:[".vertical-center-modal {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n        .vertical-center-modal .ant-modal {\n        top: 0;\n      }"]}),e})(),be=(()=>{class e{constructor(e,t){this.http=e,this.messageService=t}outUser(e){return this.http.post("/user/out",e).pipe(Object(y.a)(e=>{this.messageService.success(e.message)}),Object(v.a)(e=>(console.log("\u8e22\u51fa\u7528\u6237\u5931\u8d25",e),this.messageService.error(e.error||e.errMessage),Object(ie.a)(e))))}}return e.\u0275fac=function(t){return new(t||e)(c.dc(a.r),c.dc(T.e))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var me=n("ZyQt");const ge=["crud"];function fe(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",4),c.hc("click",(function(){c.Ec(e);const n=t.$implicit;return c.kc().outOnlineUser(n)})),c.Ub(1,"i",5),c.Oc(2,"\u8e22\u51fa\u7528\u6237"),c.Yb()}2&e&&c.sc("acl-ability","user_online_out")}function ye(e,t){if(1&e&&(c.Xb(0),c.Zb(1,"nz-tag",7),c.Oc(2),c.Yb(),c.Wb()),2&e){const e=t.$implicit;c.Db(1),c.sc("nzColor","geekblue"),c.Db(1),c.Pc(e.name)}}function ve(e,t){1&e&&c.Mc(0,ye,3,2,"ng-container",6),2&e&&c.sc("ngForOf",t.$implicit.roles)}const xe=function(){return{}};let Te=(()=>{class e{constructor(e){this.onlineService=e,this.url="/user/online",this.tableAction={width:100,buttons:[{text:"\u8e22\u51fa",acl:{ability:["user_online_out"]},type:"del",pop:"\u786e\u8ba4\u8981\u8e22\u51fa\u5417\uff1f",icon:"logout",iifBehavior:"disabled",click:e=>{this.onlineService.outUser({tokens:[e.token]}).subscribe(()=>this.crud.load())}}]},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left"},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u6635\u79f0",index:"nickname"},{title:"token",index:"token",widthMode:{type:"strict",strictBehavior:"truncate"}},{title:"\u624b\u673a\u53f7",index:"phoneNumber"},{title:"\u5934\u50cf",type:"img",width:80,index:"avatar"},{title:"\u4e0a\u6b21\u767b\u5f55ip",index:"lastLoginIp"},{title:"\u4e0a\u6b21\u767b\u5f55\u65f6\u95f4",index:"lastLoginTime"}],console.log(this,"UserComponent\u7684this")}outOnlineUser({checkbox:e}){const t=e.map(e=>e.token);this.onlineService.outUser({tokens:t}).subscribe(()=>this.crud.load())}crudChange(e){console.log(e,"crudChange")}ngAfterViewInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(be))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-online-user"]],viewQuery:function(e,t){var n;1&e&&c.Tc(ge,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},decls:4,vars:6,consts:[[3,"columns","data","event","usePagination","tableAction","change"],["crud",""],["crud-top-button",""],["crud-row","roles"],["acl","","nzDanger","","nz-button","","nzType","primary",3,"acl-ability","click"],["nz-icon","","nzType","user","nzTheme","outline"],[4,"ngFor","ngForOf"],[3,"nzColor"]],template:function(e,t){1&e&&(c.Zb(0,"app-crud",0,1),c.hc("change",(function(e){return t.crudChange(e)})),c.Mc(2,fe,3,1,"ng-template",2),c.Mc(3,ve,1,1,"ng-template",3),c.Yb()),2&e&&c.sc("columns",t.columns)("data",t.url)("event",c.vc(5,xe))("usePagination",!1)("tableAction",t.tableAction)},directives:[J,b,g,l.a,d.a,A.a,u.a,O.a,z.l,me.a],styles:[""]}),e})(),ze=(()=>{class e{constructor(e,t){this.http=e,this.messageService=t}getOptions(){return this.http.get("/user/menu").pipe(Object(re.a)(e=>le(e.data,e=>({title:e.text,key:e._id}))),Object(v.a)(()=>Object(W.a)([])))}assigningMenus(e){return this.http.patch("/role/assigningMenus",e).pipe(Object(y.a)(e=>{this.messageService.success(e.message)}))}}return e.\u0275fac=function(t){return new(t||e)(c.dc(a.r),c.dc(T.e))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),ke=(()=>{class e{constructor(e,t,n){this.http=e,this.modal=t,this.assignMenus=n,this._formData={menuIds:[]},this._role={},this.schema={properties:{menuIds:{type:"string",title:"\u83dc\u5355",ui:{spanLabel:2,spanControl:22,widget:"tree-select",checkable:!0,mode:"tags",placeholder:"\u8bf7\u9009\u62e9\u83dc\u5355",checkStrictly:!0,expandedKeys:[],asyncData:()=>this.assignMenus.getOptions()}}}}}set role(e){this._role=e,console.log(e),this._formData.menuIds=this.getMenuIds(e.menus),this.schema.properties.menuIds.ui.expandedKeys=this._formData.menuIds}get role(){return this._role}getMenuIds(e){const t=[];return function e(n){return n?(n.forEach(n=>{t.push(n._id),e(n.children)}),t):[]}(e),t}save(e){this.assignMenus.assigningMenus({roleId:this.role._id,menuIds:e.menuIds}).subscribe(e=>{this.close(e)}),console.log(e)}close(e){this.modal.destroy(e)}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(a.r),c.Tb(o.b),c.Tb(ze))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-role-assign-menus"]],inputs:{role:"role"},decls:10,vars:5,consts:[["nzTip","\u62fc\u547d\u52a0\u8f7d\u4e2d","nzSize","large",1,"modal-spin",3,"nzSpinning"],["mode","edit","button","none",3,"schema","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(e,t){if(1&e){const e=c.ac();c.Zb(0,"nz-spin",0),c.Zb(1,"sf",1,2),c.Zb(3,"div",3),c.Zb(4,"button",4),c.hc("click",(function(){return t.close()})),c.Oc(5,"\u5173\u95ed"),c.Yb(),c.Zb(6,"button",4),c.hc("click",(function(){return c.Ec(e),c.Bc(2).reset(!0)})),c.Oc(7,"\u91cd\u7f6e"),c.Yb(),c.Zb(8,"button",5),c.hc("click",(function(){c.Ec(e);const n=c.Bc(2);return t.save(n.value)})),c.Oc(9," \u4fdd\u5b58 "),c.Yb(),c.Yb(),c.Yb(),c.Yb()}if(2&e){const e=c.Bc(2);c.sc("nzSpinning",t.http.loading),c.Db(1),c.sc("schema",t.schema)("formData",t._formData),c.Db(7),c.sc("disabled",!e.valid)("nzLoading",t.http.loading)}},directives:[r.a,s.b,l.a,d.a,u.a],encapsulation:2}),e})();var Oe=n("nxWG");const _e=["crud"];function De(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",4),c.hc("click",(function(){c.Ec(e);const n=t.$implicit;return c.kc().assignMenus(n)})),c.Ub(1,"i",5),c.Oc(2,"\u5206\u914d\u83dc\u5355"),c.Yb()}if(2&e){const e=t.$implicit;c.sc("disabled",!e.checkbox||1!==e.checkbox.length)}}function we(e,t){if(1&e&&(c.Zb(0,"span",9),c.Ub(1,"i",10),c.Zb(2,"span",11),c.Oc(3),c.Yb(),c.Yb()),2&e){const e=t.$implicit,n=t.origin;c.Db(1),c.sc("nzType",e.isExpanded?"folder-open":"folder"),c.Db(2),c.Pc(n.text)}}function Ce(e,t){1&e&&(c.Zb(0,"nz-tree",6,7),c.Mc(2,we,4,2,"ng-template",null,8,c.Nc),c.Yb()),2&e&&c.sc("nzData",t.$implicit.menus)}let Ae=(()=>{class e{constructor(e,t,n){this.el=e,this.modal=t,this.messageService=n,this.url="/role/pagination",this.event={url:"/role",addAbility:"role_add",editAbility:"role_edit",delAbility:"role_del",options:{successCallback:()=>{this.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:()=>{console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:({columnData:e})=>(console.log(e),{url:"/role/"+e._id})},del:{reData({fromData:e}){console.log(e);const t=[];return e instanceof Array?e.forEach(e=>t.push(e._id)):t.push(e._id),{roleIds:t}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u521b\u5efa\u8005id",index:"creatorId",fromHidden:!0,show:!1},{title:"\u89d2\u8272\u540d",index:"name",required:!0},{title:"\u8bf4\u660e/\u63cf\u8ff0",index:"explanation"},{title:"\u83dc\u5355",render:"menus",fromHidden:!0,width:"auto"},{type:"date",index:"createdAt",title:"\u521b\u5efa\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0}],console.log(this,"UserComponent\u7684this")}assignMenus(e){this.modal.open(ke,{role:e.checkbox[0]},"md",{nzTitle:"\u5206\u914d\u83dc\u5355"}).subscribe(e=>{e&&this.crud.load()})}crudChange(e){console.log(e,"crudChange")}ngAfterViewInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(c.l),c.Tb(a.j),c.Tb(T.e))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-user"]],viewQuery:function(e,t){var n;1&e&&c.Tc(_e,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},decls:4,vars:3,consts:[[3,"columns","data","event","change"],["crud",""],["crud-top-button",""],["crud-row","menus"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-icon","","nzType","menu","nzTheme","outline"],["nzShowIcon","",3,"nzData"],["nzTree",""],["nzTreeTemplate",""],[1,"custom-node"],["nz-icon","",1,"p-sm",3,"nzType"],[1,"folder-name"]],template:function(e,t){1&e&&(c.Zb(0,"app-crud",0,1),c.hc("change",(function(e){return t.crudChange(e)})),c.Mc(2,De,3,1,"ng-template",2),c.Mc(3,Ce,4,1,"ng-template",3),c.Yb()),2&e&&c.sc("columns",t.columns)("data",t.url)("event",t.event)},directives:[J,b,g,l.a,d.a,u.a,O.a,Oe.a],encapsulation:2}),e})();var Ie=n("tyNb");let Se=(()=>{class e{constructor(e,t){this.http=e,this.messageService=t}getOptions(){return this.http.get("/role/list").pipe(Object(re.a)(e=>e.data.map(e=>({label:e.name,value:e._id}))),Object(v.a)(()=>Object(W.a)([])))}assigningRole(e){return this.http.patch("/role/assigningRoles",e).pipe(Object(y.a)(e=>{this.messageService.success(e.message)}))}}return e.\u0275fac=function(t){return new(t||e)(c.dc(a.r),c.dc(T.e))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),je=(()=>{class e{constructor(e,t,n){this.http=e,this.modal=t,this.drs=n,this._formData={roleIds:[]},this._user={},this.schema={properties:{roleIds:{type:"string",title:"\u89d2\u8272",ui:{spanLabel:2,spanControl:22,widget:"select",mode:"tags",placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272",asyncData:()=>this.drs.getOptions()}}}}}set user(e){this._user=e,console.log(e),this._formData.roleIds=e.roles.map(e=>e._id),console.log(this._formData)}get user(){return this._user}save(e){this.drs.assigningRole({userId:this.user._id,roleIds:e.roleIds}).subscribe(e=>{this.close(e)}),console.log(e)}close(e){this.modal.destroy(e)}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(a.r),c.Tb(o.b),c.Tb(Se))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-user-designated-role"]],inputs:{user:"user"},decls:10,vars:5,consts:[["nzTip","\u62fc\u547d\u52a0\u8f7d\u4e2d","nzSize","large",1,"modal-spin",3,"nzSpinning"],["mode","edit","button","none",3,"schema","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(e,t){if(1&e){const e=c.ac();c.Zb(0,"nz-spin",0),c.Zb(1,"sf",1,2),c.Zb(3,"div",3),c.Zb(4,"button",4),c.hc("click",(function(){return t.close()})),c.Oc(5,"\u5173\u95ed"),c.Yb(),c.Zb(6,"button",4),c.hc("click",(function(){return c.Ec(e),c.Bc(2).reset(!0)})),c.Oc(7,"\u91cd\u7f6e"),c.Yb(),c.Zb(8,"button",5),c.hc("click",(function(){c.Ec(e);const n=c.Bc(2);return t.save(n.value)})),c.Oc(9," \u4fdd\u5b58 "),c.Yb(),c.Yb(),c.Yb(),c.Yb()}if(2&e){const e=c.Bc(2);c.sc("nzSpinning",t.http.loading),c.Db(1),c.sc("schema",t.schema)("formData",t._formData),c.Db(7),c.sc("disabled",!e.valid)("nzLoading",t.http.loading)}},directives:[r.a,s.b,l.a,d.a,u.a],encapsulation:2}),e})();const Me=["crud"];function Ze(e,t){if(1&e){const e=c.ac();c.Zb(0,"button",4),c.hc("click",(function(){c.Ec(e);const n=t.$implicit;return c.kc().designatedRole(n)})),c.Ub(1,"i",5),c.Oc(2,"\u6307\u5b9a\u89d2\u8272"),c.Yb()}if(2&e){const e=t.$implicit;c.sc("disabled",!e.checkbox||1!==e.checkbox.length)}}function Ye(e,t){if(1&e&&(c.Xb(0),c.Zb(1,"nz-tag",7),c.Oc(2),c.Yb(),c.Wb()),2&e){const e=t.$implicit;c.Db(1),c.sc("nzColor","geekblue"),c.Db(1),c.Pc(e.name)}}function Ee(e,t){1&e&&c.Mc(0,Ye,3,2,"ng-container",6),2&e&&c.sc("ngForOf",t.$implicit.roles)}const He=[{path:"menu",canActivate:[A.b],data:{guard:{ability:["menu_read"]}},component:pe},{path:"user",canActivate:[A.b],data:{guard:{ability:["user_read"]}},component:(()=>{class e{constructor(e,t,n){this.el=e,this.modal=t,this.messageService=n,this.url="/user/pagination",this.event={url:"/user",addAbility:"user_add",editAbility:"user_edit",delAbility:"user_del",options:{successCallback:()=>{this.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:()=>{console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:({columnData:e})=>(console.log(e),{url:"/user/"+e._id})},del:{reData({fromData:e}){console.log(e);const t=[];return e instanceof Array?e.forEach(e=>t.push(e._id)):t.push(e._id),{userIds:t}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u521b\u5efa\u8005id",index:"creatorId",fromHidden:!0,show:!1},{title:"\u6635\u79f0",index:"nickname",required:!0},{title:"\u7528\u6237\u540d",index:"username",required:!0},{title:"\u5bc6\u7801",index:"password",iif:()=>!1,required:!0,fromEditHidden:!0,schema:{maxLength:11,minLength:6,ui:{type:"password"}}},{title:"\u624b\u673a\u53f7",index:"phoneNumber",schema:{type:"string",format:"mobile"}},{renderTitle:"roles",render:"roles",fromHidden:!0},{title:"\u5934\u50cf",type:"img",width:80,index:"avatar",schema:{ui:{widget:"upload",action:"/upload",resReName:"data.url",urlReName:"data.url",listType:"picture-card",limitFileCount:1,fileType:"image/png,image/jpeg,image/gif,image/bmp"}}},{title:"\u4e0a\u6b21\u767b\u5f55ip",index:"lastLoginIp",fromHidden:!0},{title:"\u4e0a\u6b21\u767b\u5f55\u65f6\u95f4",index:"lastLoginTime",fromHidden:!0},{title:"\u72b6\u6001",type:"yn",index:"status",yn:{yes:"\u542f\u7528",no:"\u7981\u7528"},schema:{type:"string",enum:[{label:"\u542f\u7528",value:!0},{label:"\u7981\u7528",value:!1}],ui:{widget:"radio"},default:!0}}],console.log(this,"UserComponent\u7684this")}designatedRole(e){this.modal.open(je,{user:e.checkbox[0]},"md",{nzTitle:"\u6307\u6d3e\u89d2\u8272"}).subscribe(e=>{e&&this.crud.load()})}crudChange(e){console.log(e,"crudChange")}ngAfterViewInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(c.l),c.Tb(a.j),c.Tb(T.e))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-user"]],viewQuery:function(e,t){var n;1&e&&c.Tc(Me,!0),2&e&&c.Ac(n=c.ic())&&(t.crud=n.first)},decls:4,vars:3,consts:[[3,"columns","data","event","change"],["crud",""],["crud-top-button",""],["crud-row","roles"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-icon","","nzType","usergroup-add","nzTheme","outline"],[4,"ngFor","ngForOf"],[3,"nzColor"]],template:function(e,t){1&e&&(c.Zb(0,"app-crud",0,1),c.hc("change",(function(e){return t.crudChange(e)})),c.Mc(2,Ze,3,1,"ng-template",2),c.Mc(3,Ee,1,1,"ng-template",3),c.Yb()),2&e&&c.sc("columns",t.columns)("data",t.url)("event",t.event)},directives:[J,b,g,l.a,d.a,u.a,O.a,z.l,me.a],styles:[""]}),e})()},{path:"logging",canActivate:[A.b],data:{guard:{ability:["logging_read"]}},component:ae},{path:"role",canActivate:[A.b],data:{guard:{ability:["role_read"]}},component:Ae},{path:"dictionary",canActivate:[A.b],data:{guard:{ability:["dictionary_read"]}},component:ne},{path:"online",canActivate:[A.b],data:{guard:{ability:["user_online_read"]}},component:Te}];let Re=(()=>{class e{}return e.\u0275mod=c.Rb({type:e}),e.\u0275inj=c.Qb({factory:function(t){return new(t||e)},imports:[[Ie.m.forChild(He)],Ie.m]}),e})(),Pe=(()=>{class e{}return e.\u0275mod=c.Rb({type:e}),e.\u0275inj=c.Qb({factory:function(t){return new(t||e)},imports:[[Re,V]]}),e})()}}]);