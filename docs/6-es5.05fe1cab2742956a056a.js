function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{Z0ed:function(e,t,n){"use strict";n.r(t),n.d(t,"SettingModule",(function(){return lt}));var i,a,c,r,o,s,l=n("PCNd"),u=n("ok2U"),d=n("fXoL"),h=n("dEAy"),f=n("Ac7g"),p=n("qAZ0"),b=n("OzZK"),m=n("RwU8"),y=n("C2AL"),g=((o=function(){function e(t,n){_classCallCheck(this,e),this.modal=t,this.http=n,this.ui={},this._formData={}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.value&&Object.keys(this.schema.properties).forEach((function(t){return e._formData[t]=e.value[t]}))}},{key:"ngAfterViewInit",value:function(){}},{key:"save",value:function(e){console.log(e,this.event,"save"),this.event&&this.event(e,this.close.bind(this))}},{key:"close",value:function(){this.modal.destroy()}}]),e}()).\u0275fac=function(e){return new(e||o)(d.Tb(h.b),d.Tb(f.r))},o.\u0275cmp=d.Nb({type:o,selectors:[["app-crud-from"]],viewQuery:function(e,t){var n;1&e&&d.Tc(u.b,!0),2&e&&d.Ac(n=d.ic())&&(t.sf=n.first)},inputs:{schema:"schema",ui:"ui",mode:"mode",value:"value",event:"event"},decls:13,vars:7,consts:[[1,"modal-header"],[1,"modal-title"],["nzTip","\u62fc\u547d\u52a0\u8f7d\u4e2d","nzSize","large",1,"modal-spin",3,"nzSpinning"],["mode","edit","button","none",3,"schema","ui","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(e,t){if(1&e){var n=d.ac();d.Zb(0,"div",0),d.Zb(1,"div",1),d.Oc(2),d.Yb(),d.Yb(),d.Zb(3,"nz-spin",2),d.Zb(4,"sf",3,4),d.Zb(6,"div",5),d.Zb(7,"button",6),d.hc("click",(function(){return t.close()})),d.Oc(8,"\u5173\u95ed"),d.Yb(),d.Zb(9,"button",6),d.hc("click",(function(){return d.Ec(n),d.Bc(5).reset(!0)})),d.Oc(10,"\u91cd\u7f6e"),d.Yb(),d.Zb(11,"button",7),d.hc("click",(function(){d.Ec(n);var e=d.Bc(5);return t.save(e.value)})),d.Oc(12,"\u4fdd\u5b58"),d.Yb(),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.Bc(5);d.Db(2),d.Qc("","add"===t.mode?"\u65b0\u589e":"\u7f16\u8f91","\u4fe1\u606f"),d.Db(1),d.sc("nzSpinning",t.http.loading),d.Db(1),d.sc("schema",t.schema)("ui",t.ui)("formData",t._formData),d.Db(7),d.sc("disabled",!i.valid)("nzLoading",t.http.loading)}},directives:[p.a,u.b,b.a,m.a,y.a],encapsulation:2}),o),v=((r=function(){function e(){_classCallCheck(this,e),this.buttons=[]}return _createClass(e,[{key:"addButton",value:function(e){this.buttons.push(e)}},{key:"topButtons",get:function(){return this.buttons}}]),e}()).\u0275fac=function(e){return new(e||r)},r.\u0275prov=d.Pb({token:r,factory:r.\u0275fac}),r),k=((c=function(){function e(t,n){_classCallCheck(this,e),this.tRef=t,this.crudTopButton=n}return _createClass(e,[{key:"ngOnInit",value:function(){this.crudTopButton.addButton(this.tRef)}}]),e}()).\u0275fac=function(e){return new(e||c)(d.Tb(d.M,8),d.Tb(v))},c.\u0275dir=d.Ob({type:c,selectors:[["","crud-top-button",""]]}),c),_=((a=function(){function e(){_classCallCheck(this,e),this.titles={},this.rows={}}return _createClass(e,[{key:"addTitle",value:function(e,t){return this.titles[e]=t}},{key:"addRow",value:function(e,t){return this.rows[e]=t}},{key:"getTitle",value:function(e){return this.titles[e]}},{key:"getRow",value:function(e){return this.rows[e]}},{key:"titleKeys",get:function(){return Object.keys(this.titles)}},{key:"rowKeys",get:function(){return Object.keys(this.rows)}}]),e}()).\u0275fac=function(e){return new(e||a)},a.\u0275prov=d.Pb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),C=((i=function(){function e(t,n){_classCallCheck(this,e),this.ref=t,this.source=n}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"row",set:function(e){this.source.addRow(e,this.ref)}}]),e}()).\u0275fac=function(e){return new(e||i)(d.Tb(d.M),d.Tb(_))},i.\u0275dir=d.Ob({type:i,selectors:[["","crud-row",""]],inputs:{row:["crud-row","row"]}}),i),T=n("3E0/"),x=n("vkgz"),z=n("JIr8"),O=((s=function(){function e(t,n,i,a){var c=this;_classCallCheck(this,e),this.crudTemplateRef=t,this.modelHelper=n,this.http=i,this.modalService=a,this._formData={},this.schema={properties:{},ui:{grid:{xs:24,sm:24,md:24,lg:12,xl:12},"*":{spanLabel:4,spanControl:20}},required:[]},this.tableAction={title:"\u64cd\u4f5c",fixed:"right",width:150,fromHidden:!1,iif:function(){return c.tableActionIif},buttons:[{text:"\u7f16\u8f91",icon:"edit",prefix:"edit",iif:function(){return!1!==c.event.edit&&c.editIif},click:function(e){c._data=e,c.openModelForm("edit",e)}},{text:"\u5220\u9664",icon:"delete",type:"del",prefix:"del",iif:function(){return!1!==c.event.del&&c.delIif},click:function(e){console.log("\u5220\u9664\u65f6\u4f20\u6765\u7684\u53c2\u6570",e),c.handleDelete(e)}}]},this.defaultSchemaUi={placeholder:""}}return _createClass(e,[{key:"getReqOptions",value:function(e,t,n){return Object.assign({url:e.url||this.baseUrl,method:e.method||t,data:e.reData?e.reData({columnData:this._data,fromData:n}):n},e.reReq?e.reReq({columnData:this._data,fromData:n}):{})}},{key:"handleAdd",value:function(e,t){var n=this.event.add||{};if(n instanceof Function)n(e,t);else{var i=this.getReqOptions(n,"post",e),a=Object.assign(Object.assign({},this.event.options),n.options);this.customHttp(i,Object.assign(Object.assign({},a),{loading:t}))}}},{key:"handleEdit",value:function(e,t){var n=this.event.edit||{};if(n instanceof Function)n(this._data,e,t);else{var i=this.getReqOptions(n,"put",e),a=Object.assign(Object.assign({},this.event.options),n.options);this.customHttp(i,Object.assign(Object.assign({},a),{loading:t}))}}},{key:"handleDelete",value:function(e){var t=this.event.del||{};if(t instanceof Function)t(e);else{var n=this.getReqOptions(t,"delete",e),i=Object.assign(Object.assign({},this.event.options),t.options);this.customHttp(n,i)}}},{key:"customHttp",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.http.request(e.method,e.url,{body:"get"===e.method?{}:e.data,params:"get"===e.method?e.data:{}}).pipe(Object(T.a)(300),Object(x.a)((function(){n.loading&&n.loading()})),Object(z.a)(n.errorCallback||function(e){t.errorCallback(e,n)})).subscribe(n.successCallback||function(e){t.successCallback(e,n)})}},{key:"errorCallback",value:function(e,t){t&&t.loading instanceof Function&&t.loading(),console.log(e,arguments,"\u770b\u770b\u9519\u8bef\u56de\u8c03")}},{key:"successCallback",value:function(e,t){t&&t.loading instanceof Function&&t.loading(),console.log(e,arguments,"\u770b\u770b\u6210\u529f\u56de\u8c03")}},{key:"columnsInit",value:function(e){var t=this,n=[];return e.forEach((function(e){n.push(Object.assign(Object.assign({},e),{__render:t.crudTemplateRef.getRow(e.render),__renderTitle:t.crudTemplateRef.getTitle(e.renderTitle)}))})),console.log(n),n}},{key:"getPropertiesName",value:function(e){return e.index?e.index instanceof Array?e.index[e.index.length-1]:e.index:e.render?e.render:void 0}},{key:"getSchema",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add",n=JSON.parse(JSON.stringify(this.schema));return this.columns.forEach((function(i){var a;if(!i.fromHidden&&!("add"===t&&!0===i.fromAddHidden||"edit"===t&&!0===i.fromEditHidden)){var c=e.getPropertiesName(i),r=(null===(a=i.title)||void 0===a?void 0:a.text)||i.title||i.renderTitle;e.defaultSchemaUi.placeholder="\u8bf7\u8f93\u5165 "+r,i.required&&n.required.push(c),n.properties[c]=Object.assign({title:r,type:"string",ui:e.defaultSchemaUi},i.schema),i.schema&&(console.log(i.schema,"readOnly",Reflect.has(i.schema,"addReadOnly")),Reflect.has(i.schema,"readOnly")?n.properties[c].readOnly=i.schema.readOnly:"edit"===t&&Reflect.has(i.schema,"editReadOnly")?n.properties[c].readOnly=i.schema.editReadOnly:"add"===t&&Reflect.has(i.schema,"addReadOnly")&&(n.properties[c].readOnly=i.schema.addReadOnly),console.log(n.properties[c],"rado"));var o=n.properties[c].ui;n.properties[c].ui=Object.assign(Object.assign({},e.defaultSchemaUi),o)}})),{schema:n}}},{key:"openModelForm",value:function(e,t){var n=this.getSchema(e).schema;this.modelHelper.static(g,{schema:n,value:t,mode:e,event:("edit"===e?this.handleEdit:this.handleAdd).bind(this)},"lg",{nzKeyboard:!1}).subscribe((function(e){console.log(e)}))}},{key:"changeColumns",value:function(e){var t=this,n=[],i=[];e.forEach((function(e){var t;i.push({key:e.index||e.render,title:(null===(t=e.title)||void 0===t?void 0:t.text)||e.title||e.renderTitle,direction:!1===e.show?"left":"right"}),n.push(Object.assign(Object.assign({},e),{iif:function(){var t=arguments.length<=0?void 0:arguments[0];return e.iif?!1!==t.show&&e.iif.apply(e,arguments):!1!==t.show}}))})),console.log(this.event);var a=Object.assign(Object.assign({},this.tableAction),{buttons:this.tableAction.buttons.map((function(e){var n=t.event[e.prefix+"Ability"];return Object.assign(Object.assign({},e),{acl:n?{ability:[n]}:null})}))});return console.log(a,"acl tableAction"),n.push(a),this.columns=e,{columns:n,transferData:i}}},{key:"tableActionIif",get:function(){return 2!==this.tableAction.buttons.length||this.event&&(this.event.add||this.event.edit||this.baseUrl)}},{key:"addIif",get:function(){return this.event.add||this.baseUrl}},{key:"editIif",get:function(){return this.event.edit||this.baseUrl}},{key:"delIif",get:function(){return this.event.del||this.baseUrl}},{key:"event",set:function(e){this._event=e,e&&(this.baseUrl=e.url)},get:function(){return this._event}}]),e}()).\u0275fac=function(e){return new(e||s)(d.dc(_),d.dc(f.j),d.dc(f.r),d.dc(h.c))},s.\u0275prov=d.Pb({token:s,factory:s.\u0275fac}),s),w=n("PScX"),D=n("ofXK"),A=n("Nqz0"),I=n("FwiY"),S=n("Q8cG"),j=n("F6ss"),M=n("GuFl"),Z=n("DGaY"),E=n("atJ9"),Y=["st"];function H(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",22),d.hc("click",(function(){return d.Ec(n),d.kc(2).topAddBtn("add")})),d.Ub(1,"i",23),d.Oc(2,"\u65b0\u589e"),d.Yb()}if(2&e){var i=d.kc(2);d.sc("acl-ability",i.event.addAbility)}}function R(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",24),d.hc("click",(function(){return d.Ec(n),d.kc(2).topEditBtn("edit")})),d.Ub(1,"i",25),d.Oc(2,"\u7f16\u8f91"),d.Yb()}if(2&e){var i=d.kc(2);d.sc("disabled",i.topEditBtnDisabled)("acl-ability",i.event.editAbility)}}function P(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",26),d.hc("click",(function(){return d.Ec(n),d.kc(2).topDelBtn()})),d.Ub(1,"i",27),d.Oc(2,"\u5220\u9664"),d.Yb()}if(2&e){var i=d.kc(2);d.sc("disabled",i.topDelBtnDisabled)("acl-ability",i.event.delAbility)}}function L(e,t){if(1&e&&(d.Xb(0),d.Mc(1,H,3,1,"button",19),d.Mc(2,R,3,2,"button",20),d.Mc(3,P,3,2,"button",21),d.Wb()),2&e){var n=d.kc();d.Db(1),d.sc("ngIf",n.addIif),d.Db(1),d.sc("ngIf",n.editIif),d.Db(1),d.sc("ngIf",n.delIif)}}function B(e,t){}var U=function(e){return{$implicit:e}};function F(e,t){if(1&e&&d.Mc(0,B,0,0,"ng-template",28),2&e){var n=t.$implicit,i=d.kc();d.sc("ngTemplateOutlet",n)("ngTemplateOutletContext",d.wc(2,U,i.topButtonsContext))}}function q(e,t){}var N=function(e,t,n){return{$implicit:e,index:t,column:n}};function $(e,t){if(1&e&&d.Mc(0,q,0,0,"ng-template",28),2&e){var n=t.$implicit,i=t.index,a=t.column,c=d.kc(2).$implicit;d.sc("ngTemplateOutlet",c.__render)("ngTemplateOutletContext",d.yc(2,N,n,i,a))}}function Q(e,t){if(1&e&&(d.Xb(0),d.Mc(1,$,1,6,"ng-template",29),d.Wb()),2&e){var n=d.kc().$implicit;d.Db(1),d.sc("st-row",n.render)}}function G(e,t){}var W=function(e,t){return{$implicit:e,index:t}};function J(e,t){if(1&e&&d.Mc(0,G,0,0,"ng-template",28),2&e){var n=t.$implicit,i=t.index,a=d.kc(2).$implicit;d.sc("ngTemplateOutlet",a.__renderTitle)("ngTemplateOutletContext",d.xc(2,W,n,i))}}function V(e,t){if(1&e&&(d.Xb(0),d.Mc(1,J,1,5,"ng-template",30),d.Wb()),2&e){var n=d.kc().$implicit;d.Db(1),d.sc("st-row",n.renderTitle)}}function X(e,t){if(1&e&&(d.Xb(0),d.Mc(1,Q,2,1,"ng-container",2),d.Mc(2,V,2,1,"ng-container",2),d.Wb()),2&e){var n=t.$implicit;d.Db(1),d.sc("ngIf",n.__render),d.Db(1),d.sc("ngIf",n.__renderTitle)}}var K,ee,te=function(){return{"height.vh":40}},ne=function(){return["\u9690\u85cf","\u5c55\u793a"]},ie=((ee=function(){function e(t,n,i,a,c){var r=this;_classCallCheck(this,e),this.crudService=t,this.modalService=n,this.messageService=i,this.crudTopButton=a,this.viewContainer=c,this._formData={},this.crudChange=new d.n,this.scroll={x:"100vw",y:"70vh"},this.usePagination=!0,this._event=null,this.total=0,this.page={front:!1,show:!0,showQuickJumper:!0,placement:"center"},this.req={reName:{pi:"page",ps:"limit"}},this.res={process:function(e,t){return"object"==typeof r.data?t:(r.total=r.usePagination?t.data.pagination.total:0,r.usePagination?t.data.data:t.data)}},this.visible=!1,this.transferDataSource=[]}return _createClass(e,[{key:"ngOnChanges",value:function(e){var t=e.columns;if(t&&t.currentValue){var n=this.crudService.changeColumns(t.currentValue);console.log(t.currentValue,n,"\u6709\u65e0\u66f4\u65b0"),this.columns=n.columns,this.transferDataSource=n.transferData}}},{key:"stChange",value:function(e){switch(this.crudChange.emit(e),e.type){case"radio":return this._stChangeType=e.type,void(this._radio=e.radio);case"checkbox":return this._stChangeType=e.type,void(this._checkbox=e.checkbox)}}},{key:"topEditBtn",value:function(e){var t=this._checkbox;"radio"===this._stChangeType?this.crudService._data=this._radio:"checkbox"===this._stChangeType&&(this.crudService._data=t[0]),this.crudService.openModelForm(e,t[0])}},{key:"topDelBtn",value:function(){var e=this;this.modalService.confirm({nzTitle:"\u786e\u8ba4\u5220\u9664\uff1f",nzContent:'<b style="color: red;">\u4f60\u662f\u5426\u786e\u5b9a\u8981\u5220\u9664\u52fe\u9009\u7684\u5168\u90e8\u6570\u636e\uff1f</b>',nzOkText:"\u5220\u9664",nzOkType:"danger",nzCancelText:"\u53d6\u6d88",nzOnOk:function(){e.crudService.handleDelete(e["_"+e._stChangeType])},nzOnCancel:function(){return console.log("Cancel")}})}},{key:"topAddBtn",value:function(e){console.log(this.formData),this.crudService.openModelForm(e,this.formData)}},{key:"ngOnInit",value:function(){console.log(this.data,"init"),this.columns=this.crudService.columnsInit(this.columns)}},{key:"open",value:function(){this.visible=!0}},{key:"close",value:function(){this.visible=!1}},{key:"load",value:function(){var e;this._checkbox=[],this._radio={},this._stChangeType="",(e=this.st).load.apply(e,arguments)}},{key:"transferChange",value:function(e){var t=e.list.map((function(e){return e.key}));this.columns=this.columns.map((function(e){return t.includes(e.index)||t.includes(e.render)?Object.assign(Object.assign({},e),{show:!1===e.show}):e}))}},{key:"ngAfterViewInit",value:function(){}},{key:"formData",set:function(e){this._formData=e||{},this.crudService._formData=e||{}},get:function(){return this._formData}},{key:"tableAction",set:function(e){e&&(this.crudService.tableAction=Object.assign(Object.assign(Object.assign({},this.crudService.tableAction),e),{buttons:[].concat(_toConsumableArray(this.crudService.tableAction.buttons),_toConsumableArray(e.buttons))}),console.log(this.crudService.tableAction,"tableAction"),this.crudService.columnsInit(this.columns))}},{key:"schema",set:function(e){this.crudService.schema=Object.assign(Object.assign({},this.crudService.schema),e)}},{key:"columns",set:function(e){this._columns=e},get:function(){return this._columns}},{key:"event",set:function(e){this._event=e,this.crudService.event=e},get:function(){return this._event}},{key:"topButtonsContext",get:function(){return{radio:this._radio,checkbox:this._checkbox,changeType:this._stChangeType}}},{key:"topButtons",get:function(){return this.crudTopButton.topButtons}},{key:"tableActionIif",get:function(){return this.crudService.tableActionIif&&(!1!==this.event.topEdit||!1!==this.event.topDel||!1!==this.event.topAdd)}},{key:"editIif",get:function(){return!1!==this.event.topEdit&&this.crudService.editIif}},{key:"delIif",get:function(){return!1!==this.event.topDel&&this.crudService.delIif}},{key:"addIif",get:function(){return!1!==this.event.topAdd&&this.crudService.addIif}},{key:"topEditBtnDisabled",get:function(){if("radio"===this._stChangeType){if(!this._radio)return!0}else{if("checkbox"!==this._stChangeType)return!0;if(1!==this._checkbox.length)return!0}return!1}},{key:"topDelBtnDisabled",get:function(){return!this._stChangeType||"checkbox"===this._stChangeType&&!this._checkbox.length||"radio"===this._stChangeType&&!this._radio}}]),e}()).\u0275fac=function(e){return new(e||ee)(d.Tb(O),d.Tb(h.c),d.Tb(w.e),d.Tb(v),d.Tb(d.Q))},ee.\u0275cmp=d.Nb({type:ee,selectors:[["app-crud"]],viewQuery:function(e,t){var n;1&e&&d.Tc(Y,!0),2&e&&d.Ac(n=d.ic())&&(t.st=n.first)},inputs:{formData:"formData",tableAction:"tableAction",scroll:"scroll",schema:"schema",columns:"columns",data:"data",usePagination:"usePagination",event:"event"},outputs:{crudChange:"change"},features:[d.Cb([O,_,v]),d.Bb],decls:32,vars:19,consts:[[1,"header-wrapper","d-flex","justify-content-around","rounded-lg","py-md","px-sm","bg-white","border"],[1,"left","d-flex","justify-content-start","flex-1"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"right","d-flex","justify-content-end","flex-1"],["topRight",""],["nz-dropdown","","nz-button","","nzType","primary","nzShape","round",3,"nzDropdownMenu"],["nz-icon","","nzType","down"],["menu","nzDropdownMenu"],["nz-menu","","nzSelectable",""],["nz-menu-item",""],["nz-button","","nzType","primary","nzDanger","",3,"click"],["nz-button","","nzType","primary","nzShape","round",3,"click"],["nz-icon","","nzType","reload"],["nz-icon","","nzType","one-to-one"],["nzPlacement","right","nzTitle","\u663e\u9690\u8868\u683c\u5217",3,"nzClosable","nzVisible","nzOnClose"],[3,"nzListStyle","nzDataSource","nzTitles","nzChange"],[3,"loadingDelay","data","columns","req","res","page","total","scroll","change"],["st",""],["acl","","nz-button","","nzType","primary",3,"acl-ability","click",4,"ngIf"],["acl","","nz-button","","nzType","primary","nzGhost","",3,"disabled","acl-ability","click",4,"ngIf"],["acl","","nz-button","","nzType","primary","nzDanger","",3,"disabled","acl-ability","click",4,"ngIf"],["acl","","nz-button","","nzType","primary",3,"acl-ability","click"],["nz-icon","","nzType","plus"],["acl","","nz-button","","nzType","primary","nzGhost","",3,"disabled","acl-ability","click"],["nz-icon","","nzType","edit"],["acl","","nz-button","","nzType","primary","nzDanger","",3,"disabled","acl-ability","click"],["nz-icon","","nzType","delete"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"st-row"],["type","title",3,"st-row"]],template:function(e,t){if(1&e){var n=d.ac();d.Zb(0,"div",0),d.Zb(1,"div",1),d.Mc(2,L,4,3,"ng-container",2),d.Mc(3,F,1,4,void 0,3),d.Yb(),d.Zb(4,"div",4,5),d.Zb(6,"button",6),d.Ub(7,"i",7),d.Yb(),d.Zb(8,"nz-dropdown-menu",null,8),d.Zb(10,"ul",9),d.Zb(11,"li",10),d.Zb(12,"button",11),d.hc("click",(function(){return d.Ec(n),d.Bc(30).clear()})),d.Oc(13,"\u6570\u636e"),d.Yb(),d.Yb(),d.Zb(14,"li",10),d.Zb(15,"button",11),d.hc("click",(function(){return d.Ec(n),d.Bc(30).clearStatus(),t.load()})),d.Oc(16,"\u6240\u6709\u72b6\u6001"),d.Yb(),d.Yb(),d.Zb(17,"li",10),d.Zb(18,"button",11),d.hc("click",(function(){return d.Ec(n),d.Bc(30).clearCheck()})),d.Oc(19,"\u591a\u9009\u6309\u94ae"),d.Yb(),d.Yb(),d.Zb(20,"li",10),d.Zb(21,"button",11),d.hc("click",(function(){return d.Ec(n),d.Bc(30).clearRadio()})),d.Oc(22,"\u5355\u9009\u6309\u94ae"),d.Yb(),d.Yb(),d.Yb(),d.Yb(),d.Zb(23,"button",12),d.hc("click",(function(){return d.Ec(n),d.Bc(30).reload()})),d.Ub(24,"i",13),d.Yb(),d.Zb(25,"button",12),d.hc("click",(function(){return t.open()})),d.Ub(26,"i",14),d.Yb(),d.Yb(),d.Zb(27,"nz-drawer",15),d.hc("nzOnClose",(function(){return t.close()})),d.Zb(28,"nz-transfer",16),d.hc("nzChange",(function(e){return t.transferChange(e)})),d.Yb(),d.Yb(),d.Yb(),d.Zb(29,"st",17,18),d.hc("change",(function(e){return t.stChange(e)})),d.Mc(31,X,3,2,"ng-container",3),d.Yb()}if(2&e){var i=d.Bc(9);d.Db(2),d.sc("ngIf",t.event),d.Db(1),d.sc("ngForOf",t.topButtons),d.Db(3),d.sc("nzDropdownMenu",i),d.Db(21),d.sc("nzClosable",!1)("nzVisible",t.visible),d.Db(1),d.sc("nzListStyle",d.vc(17,te))("nzDataSource",t.transferDataSource)("nzTitles",d.vc(18,ne)),d.Db(1),d.sc("loadingDelay",t.loadingDelay)("data",t.data)("columns",t.columns)("req",t.req)("res",t.res)("page",t.page)("total",t.total)("scroll",t.scroll),d.Db(2),d.sc("ngForOf",t.columns)}},directives:[D.m,D.l,b.a,m.a,A.b,y.a,A.d,I.a,A.e,S.c,S.e,j.a,M.a,Z.a,E.a,D.r,Z.c],styles:["nz-select[_ngcontent-%COMP%] {\n        width: 120px;\n      }\n\n      nz-icon[_ngcontent-%COMP%] {\n        font-size: 24px;\n      }"]}),ee),ae=((K=function e(){_classCallCheck(this,e)}).\u0275mod=d.Rb({type:K}),K.\u0275inj=d.Qb({factory:function(e){return new(e||K)},imports:[[l.a],l.a]}),K),ce=n("LRne"),re=["crud"];function oe(e,t){if(1&e&&d.Oc(0),2&e){var n=d.kc();d.Qc(" ",n.dictionaryType.name," ")}}var se,le,ue,de=((se=function(){function e(){var t=this;_classCallCheck(this,e),this.dictionaryType={_id:"",name:""},this._url="/dictionary/type/",this.usePagination=!1,this.event={url:"/dictionary",addAbility:"dictionary_add",editAbility:"dictionary_edit",delAbility:"dictionary_del",options:{successCallback:function(){t.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:function(){console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:function(e){var n=e.columnData;return console.log(n),{url:"".concat(t.event.url,"/").concat(n.name)}}},del:{reData:function(e){var t=e.fromData;console.log(t);var n=[];return t instanceof Array?t.forEach((function(e){return n.push(e._id)})):n.push(t._id),{dictionaryTypeIds:n}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u5b57\u5178\u7c7b\u578b\u540d",render:"typeId",schema:{title:"\u5b57\u5178\u7c7b\u578bid",readOnly:!0,ui:{widget:"select",spanLabelFixed:100,grid:{span:24,spanLabelFixed:100},asyncData:function(){return Object(ce.a)(t.selectOption)}}},required:!0},{title:"\u6807\u7b7e",index:"label",required:!0},{title:"\u503c",index:"value",required:!0},{title:"\u63cf\u8ff0",index:"description"},{type:"date",index:"createdAt",title:"\u521b\u5efa\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0}]}return _createClass(e,[{key:"crudChange",value:function(e){console.log(e,"crudChange")}},{key:"formData",get:function(){return{typeId:this.dictionaryType._id}}},{key:"url",get:function(){return this._url+this.dictionaryType.name}},{key:"selectOption",get:function(){return[{label:this.dictionaryType.name,value:this.dictionaryType._id}]}}]),e}()).\u0275fac=function(e){return new(e||se)},se.\u0275cmp=d.Nb({type:se,selectors:[["app-dictionary"]],viewQuery:function(e,t){var n;1&e&&d.Tc(re,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},inputs:{dictionaryType:"dictionaryType"},decls:3,vars:5,consts:[[3,"columns","data","event","usePagination","formData"],["crud",""],["crud-row","typeName"]],template:function(e,t){1&e&&(d.Zb(0,"app-crud",0,1),d.Mc(2,oe,1,1,"ng-template",2),d.Yb()),2&e&&d.sc("columns",t.columns)("data",t.url)("event",t.event)("usePagination",t.usePagination)("formData",t.formData)},directives:[ie,C],encapsulation:2}),se),he=["crud"],fe=((le=function(){function e(t){var n=this;_classCallCheck(this,e),this.modalHelper=t,this.url="/dictionary/type/pagination",this.event={url:"/dictionary/type",addAbility:"dictionary_type_add",editAbility:"dictionary_type_edit",delAbility:"dictionary_type_del",options:{successCallback:function(){n.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:function(){console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:function(e){var t=e.columnData;return console.log(t),{url:"/dictionary/type/"+t._id}}},del:{reData:function(e){var t=e.fromData;console.log(t);var n=[];return t instanceof Array?t.forEach((function(e){return n.push(e._id)})):n.push(t._id),{dictionaryTypeIds:n}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u5b57\u5178\u7c7b\u578b\u540d",index:"name",type:"link",click:function(e){n.modalHelper.open(de,{dictionaryType:e},"xl",{nzTitle:e.name+"\u7684\u5b57\u5178",nzWrapClassName:"vertival-center-modal"}).subscribe()},schema:{ui:{spanLabelFixed:100,grid:{span:24}}},required:!0},{title:"\u8bf4\u660e/\u63cf\u8ff0",index:"description",schema:{ui:{spanLabelFixed:100,grid:{span:24}}}},{type:"date",index:"createdAt",title:"\u521b\u5efa\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0}]}return _createClass(e,[{key:"crudChange",value:function(e){console.log(e,"crudChange")}}]),e}()).\u0275fac=function(e){return new(e||le)(d.Tb(f.j))},le.\u0275cmp=d.Nb({type:le,selectors:[["app-dictionary-type"]],viewQuery:function(e,t){var n;1&e&&d.Tc(he,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},decls:2,vars:3,consts:[[3,"columns","data","event"],["crud",""]],template:function(e,t){1&e&&d.Ub(0,"app-crud",0,1),2&e&&d.sc("columns",t.columns)("data",t.url)("event",t.event)},directives:[ie],styles:[".vertical-center-modal {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n        .vertical-center-modal .ant-modal {\n        top: 0;\n      }"]}),le),pe=n("z6cu"),be=((ue=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.messageService=n}return _createClass(e,[{key:"deleteLogAll",value:function(){var e=this;return this.http.delete("/logging/all").pipe(Object(z.a)((function(t){return console.log("\u5220\u9664\u6240\u6709\u65e5\u5fd7\u5931\u8d25",t),e.messageService.error(t.error||t.errMessage),Object(pe.a)(t)})))}}]),e}()).\u0275fac=function(e){return new(e||ue)(d.dc(f.r),d.dc(w.e))},ue.\u0275prov=d.Pb({token:ue,factory:ue.\u0275fac,providedIn:"root"}),ue),me=["crud"];function ye(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",3),d.hc("click",(function(){return d.Ec(n),d.kc().deleteAllLog()})),d.Ub(1,"i",4),d.Oc(2,"\u5220\u9664\u5168\u90e8\u65e5\u5fd7"),d.Yb()}2&e&&d.sc("acl-ability","logging_del")}var ge,ve=((ge=function(){function e(t,n,i){_classCallCheck(this,e),this.logService=t,this.messageService=n,this.modalService=i,this.url="/logging/pagination",this.columns=[{title:"_id",index:"_id",show:!1},{title:"\u6807\u9898",index:"title",filter:{type:"keyword",reName:function(e,t){return{search:"title,url",title:e[0].value}}}},{type:"badge",title:"\u7c7b\u578b",index:"type",filter:{multiple:!1,menus:[{text:"\u6b63\u5e38",value:0},{text:"\u5f02\u5e38",value:1}]},badge:{0:{text:"\u6b63\u5e38",color:"success"},1:{text:"\u5f02\u5e38",color:"error"}}},{title:"\u8bbf\u95ee\u5730\u5740",index:"url",filter:{type:"keyword",reName:function(e,t){return{search:"title,url",url:e[0].value}}}},{title:"\u8bbf\u95eeip",index:"ip"},{title:"\u7528\u6237\u4fe1\u606f",index:"userId"},{title:"\u8bf7\u6c42\u65b9\u5f0f",index:"method",type:"tag",filter:{multiple:!0,menus:[{text:"GET",value:"GET"},{text:"POST",value:"POST"},{text:"DELETE",value:"DELETE"},{text:"PUT",value:"PUT"},{text:"PATCH",value:"PATCH"}]},tag:{GET:{text:"GET",color:"success"},POST:{text:"POST",color:"blue"},PUT:{text:"PUT",color:"orange"},DELETE:{text:"DELETE",color:"red"},PATCH:{text:"PATCH",color:"gold"}}},{title:"controller\u7c7b\u540d",index:"controllerName"},{title:"\u63a5\u53e3\u65b9\u6cd5\u540d",index:"funcName"},{title:"\u4f20\u9012\u53c2\u6570",index:"body",show:!1},{title:"\u5f02\u5e38\u6808",index:"stack"},{type:"date",index:"createdAt",title:"\u89e6\u53d1\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 H:mm:ss"},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",show:!1,dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 H:mm:ss"}]}return _createClass(e,[{key:"deleteAllLog",value:function(){var e=this;this.modalService.confirm({nzTitle:"\u786e\u8ba4\u5220\u9664\uff1f",nzContent:'<b style="color: red;">\u4f60\u786e\u5b9a\u8981\u5220\u9664\u6240\u6709\u65e5\u5fd7\u5417\uff1f\u8bf7\u6ce8\u610f\uff0c\u5220\u9664\u65e5\u5fd7\u8bb0\u5f55\u662f\u4e0d\u4f1a\u88ab\u5220\u9664\u7684\uff01</b>',nzOkText:"\u5220\u9664",nzOkType:"danger",nzCancelText:"\u53d6\u6d88",nzOnOk:function(){e.logService.deleteLogAll().subscribe((function(t){e.messageService.success(t.message),e.crud.load()}))}})}}]),e}()).\u0275fac=function(e){return new(e||ge)(d.Tb(be),d.Tb(w.e),d.Tb(h.c))},ge.\u0275cmp=d.Nb({type:ge,selectors:[["app-log"]],viewQuery:function(e,t){var n;1&e&&d.Tc(me,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},decls:3,vars:2,consts:[[3,"columns","data"],["crud",""],["crud-top-button",""],["acl","","nz-button","","nzType","primary","nzDanger","",3,"acl-ability","click"],["nz-icon","","nzType","delete","nzTheme","outline"]],template:function(e,t){1&e&&(d.Zb(0,"app-crud",0,1),d.Mc(2,ye,3,1,"ng-template",2),d.Yb()),2&e&&d.sc("columns",t.columns)("data",t.url)},directives:[ie,k,b.a,m.a,E.a,y.a,I.a],encapsulation:2}),ge),ke=n("lJxs");function _e(e,t){return function e(n){return n.map((function(n){var i=[];n.children&&n.children.length&&(i=JSON.parse(JSON.stringify(n.children)));var a=Object.assign({children:i.length?e(i):null},t(n));return a.children||Reflect.deleteProperty(a,"children"),a}))}(e)}var Ce,Te,xe,ze=((Ce=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.messageService=n}return _createClass(e,[{key:"handleMenuData",value:function(e){return _e(e,(function(e){return{title:e.text,key:e._id}}))}},{key:"getAllMenu",value:function(){var e=this;return this.http.get("/user/menu").pipe(Object(ke.a)((function(t){return e.handleMenuData(t.data)})))}}]),e}()).\u0275fac=function(e){return new(e||Ce)(d.dc(f.r),d.dc(w.e))},Ce.\u0275prov=d.Pb({token:Ce,factory:Ce.\u0275fac,providedIn:"root"}),Ce),Oe=n("TBCl"),we=["crud"],De=((xe=function(){function e(t,n,i,a){var c=this;_classCallCheck(this,e),this.menuService=t,this.modalHelper=n,this.startupService=i,this.modalRef=a,this.url="/user/menu",this.usePagination=!1,this.formData={pid:null},this.event={url:"/menu",addAbility:"menu_add",editAbility:"menu_edit",delAbility:"menu_del",options:{successCallback:function(){c.crud.load(),c.startupService.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:function(){console.log("\u9519\u8bef\u56de\u8c03")}},add:{reData:function(e){var t=e.fromData;return""===t.pid&&(t.pid=null),t}},edit:{reReq:function(e){var t=e.columnData;return console.log(t),{url:"/menu/"+t._id}},reData:function(e){var t=e.fromData;return""===t.pid&&(t.pid=null),console.log(t),t}},del:{reData:function(e){var t=e.fromData;console.log(t);var n=[];return t instanceof Array?t.forEach((function(e){return n.push(e._id)})):n.push(t._id),{menuIds:n}}}},this.scroll={y:"70vh",x:"150vw"},this.tableAction={width:230,buttons:[{text:"\u5b50\u83dc\u5355",icon:"menu",iifBehavior:"disabled",click:function(t){c.modalRef&&c.modalRef.close(),c.modalHelper.open(e,{pid:t._id},"xl",{nzTitle:t.text+"\u7684\u5b50\u83dc\u5355",nzWrapClassName:"vertical-center-modal"}).subscribe((function(e){console.log(e,"modal"),c.crud.load()}))},tooltip:"ST\u6682\u4e0d\u652f\u6301tree table\u6240\u4ee5\u5148\u7b80\u5355\u5b9e\u73b0 (\u6ca1\u6709\u5b50\u83dc\u5355\u65f6\u7981\u7528)"}]},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u7236\u83dc\u5355",index:"pid",schema:{addReadOnly:null,default:null,ui:{widget:"tree-select",spanLabelFixed:100,allowClear:!0,asyncData:function(){return c.menuService.getAllMenu()},grid:{span:24}}}},{title:"\u7c7b\u578b",index:"type",type:"tag",tag:{0:{text:"\u8def\u7531"},1:{text:"\u5916\u94fe"},2:{text:"\u5206\u7ec4"},3:{text:"\u6309\u94ae"}},schema:{type:"string",enum:[{label:"\u8def\u7531",value:0},{label:"\u5916\u94fe",value:1},{label:"\u5206\u7ec4",value:2},{label:"\u6309\u94ae",value:3}],ui:{spanLabel:4,spanControl:20,widget:"radio",grid:{span:24}},default:0}},{title:"\u83dc\u5355\u540d",index:"text",required:!0},{title:"\u8def\u7531",index:"link",required:!0,schema:{ui:{visibleIf:this.visibleIfType(0)}}},{title:"\u5916\u94fe",index:"externalLink",required:!0,schema:{ui:{visibleIf:this.visibleIfType(1),validator:function(e){return new RegExp("^https?://").test(e)?[]:[{keyword:"required",message:"\u5f00\u5934\u5fc5\u987b\u5305\u542bhttp://\u83b7\u53d6https://"}]}}}},{title:"\u6743\u9650\u6807\u8bc6\u7b26",index:"permissionIdentifier",required:!0,schema:{ui:{spanLabelFixed:100,grid:{span:24}}}},{title:"\u56fe\u6807",index:"icon",schema:{ui:{visibleIf:this.visibleIfType([0,1])}}},{title:"\u6392\u5e8f",index:"sort",default:"-",schema:{ui:{visibleIf:this.visibleIfType([0,1,2])},type:"number",default:1}},{title:"\u662f\u5426\u9690\u85cf",index:"hide",type:"yn",yn:{yes:"\u9690\u85cf",no:"\u663e\u793a",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u9690\u85cf",unCheckedChildren:"\u663e\u793a"},default:!1}},{title:"\u662f\u5426\u7981\u7528",index:"disabled",type:"yn",yn:{yes:"\u7981\u7528",no:"\u542f\u7528",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u7981\u7528",unCheckedChildren:"\u542f\u7528"},default:!1}},{title:"\u662f\u5426\u5feb\u6377\u83dc\u5355",index:"shortcut",type:"yn",yn:{yes:"\u662f",no:"\u5426",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u662f",unCheckedChildren:"\u5426"},default:!1}},{title:"\u662f\u5426\u5feb\u6377\u83dc\u5355\u6839",index:"shortcutRoot",type:"yn",yn:{yes:"\u662f",no:"\u5426",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType([0,1]),spanLabel:8,spanControl:16,checkedChildren:"\u662f",unCheckedChildren:"\u5426"},default:!1}},{title:"\u662f\u5426\u5141\u8bb8\u590d\u7528",index:"reuse",type:"yn",yn:{yes:"\u662f",no:"\u5426",mode:"text"},schema:{type:"boolean",ui:{visibleIf:this.visibleIfType(0),spanLabel:8,spanControl:16,checkedChildren:"\u662f",unCheckedChildren:"\u5426"},default:!1}}],this.schema={}}return _createClass(e,[{key:"visibleIfType",value:function(e){return{type:function(t){return Array.isArray(e)?e.includes(t):e===t}}}},{key:"notGroup",value:function(){return{type:function(e){return 3!==e}}}},{key:"crudChange",value:function(e){console.log(e,"crudChange")}},{key:"ngOnInit",value:function(){}},{key:"pid",set:function(e){console.log(e,"pid\u4f20\u5165"),e&&(this._pid=e,this.url="/menu/currentUser/merge/"+e,this.formData.pid=e,this.columns=this.columns.map((function(t){return!t.schema||t.schema&&void 0===t.schema.addReadOnly?Object.assign({},t):Object.assign(Object.assign({},t),{schema:Object.assign(Object.assign({},t.schema),{addReadOnly:!!e})})})))},get:function(){return console.log(this._pid),this._pid}}]),e}()).\u0275fac=function(e){return new(e||xe)(d.Tb(ze),d.Tb(f.j),d.Tb(Oe.a),d.Tb(h.b,8))},xe.\u0275cmp=d.Nb({type:xe,selectors:[["app-menu"]],viewQuery:function(e,t){var n;1&e&&d.Tc(we,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},inputs:{pid:"pid"},decls:2,vars:8,consts:[[3,"usePagination","columns","formData","tableAction","scroll","data","event","schema","change"],["crud",""]],template:function(e,t){1&e&&(d.Zb(0,"app-crud",0,1),d.hc("change",(function(e){return t.crudChange(e)})),d.Yb()),2&e&&d.sc("usePagination",t.usePagination)("columns",t.columns)("formData",t.formData)("tableAction",t.tableAction)("scroll",t.scroll)("data",t.url)("event",t.event)("schema",t.schema)},directives:[ie],styles:[".vertical-center-modal {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n        .vertical-center-modal .ant-modal {\n        top: 0;\n      }"]}),xe),Ae=((Te=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.messageService=n}return _createClass(e,[{key:"outUser",value:function(e){var t=this;return this.http.post("/user/out",e).pipe(Object(x.a)((function(e){t.messageService.success(e.message)})),Object(z.a)((function(e){return console.log("\u8e22\u51fa\u7528\u6237\u5931\u8d25",e),t.messageService.error(e.error||e.errMessage),Object(pe.a)(e)})))}}]),e}()).\u0275fac=function(e){return new(e||Te)(d.dc(f.r),d.dc(w.e))},Te.\u0275prov=d.Pb({token:Te,factory:Te.\u0275fac,providedIn:"root"}),Te),Ie=n("ZyQt"),Se=["crud"];function je(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",4),d.hc("click",(function(){d.Ec(n);var e=t.$implicit;return d.kc().outOnlineUser(e)})),d.Ub(1,"i",5),d.Oc(2,"\u8e22\u51fa\u7528\u6237"),d.Yb()}2&e&&d.sc("acl-ability","user_online_out")}function Me(e,t){if(1&e&&(d.Xb(0),d.Zb(1,"nz-tag",7),d.Oc(2),d.Yb(),d.Wb()),2&e){var n=t.$implicit;d.Db(1),d.sc("nzColor","geekblue"),d.Db(1),d.Pc(n.name)}}function Ze(e,t){1&e&&d.Mc(0,Me,3,2,"ng-container",6),2&e&&d.sc("ngForOf",t.$implicit.roles)}var Ee,Ye,He,Re=function(){return{}},Pe=((He=function(){function e(t){var n=this;_classCallCheck(this,e),this.onlineService=t,this.url="/user/online",this.tableAction={width:100,buttons:[{text:"\u8e22\u51fa",acl:{ability:["user_online_out"]},type:"del",pop:"\u786e\u8ba4\u8981\u8e22\u51fa\u5417\uff1f",icon:"logout",iifBehavior:"disabled",click:function(e){n.onlineService.outUser({tokens:[e.token]}).subscribe((function(){return n.crud.load()}))}}]},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left"},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u6635\u79f0",index:"nickname"},{title:"token",index:"token",widthMode:{type:"strict",strictBehavior:"truncate"}},{title:"\u624b\u673a\u53f7",index:"phoneNumber"},{title:"\u5934\u50cf",type:"img",width:80,index:"avatar"},{title:"\u4e0a\u6b21\u767b\u5f55ip",index:"lastLoginIp"},{title:"\u4e0a\u6b21\u767b\u5f55\u65f6\u95f4",index:"lastLoginTime"}],console.log(this,"UserComponent\u7684this")}return _createClass(e,[{key:"outOnlineUser",value:function(e){var t=this,n=e.checkbox.map((function(e){return e.token}));this.onlineService.outUser({tokens:n}).subscribe((function(){return t.crud.load()}))}},{key:"crudChange",value:function(e){console.log(e,"crudChange")}},{key:"ngAfterViewInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||He)(d.Tb(Ae))},He.\u0275cmp=d.Nb({type:He,selectors:[["app-online-user"]],viewQuery:function(e,t){var n;1&e&&d.Tc(Se,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},decls:4,vars:6,consts:[[3,"columns","data","event","usePagination","tableAction","change"],["crud",""],["crud-top-button",""],["crud-row","roles"],["acl","","nzDanger","","nz-button","","nzType","primary",3,"acl-ability","click"],["nz-icon","","nzType","user","nzTheme","outline"],[4,"ngFor","ngForOf"],[3,"nzColor"]],template:function(e,t){1&e&&(d.Zb(0,"app-crud",0,1),d.hc("change",(function(e){return t.crudChange(e)})),d.Mc(2,je,3,1,"ng-template",2),d.Mc(3,Ze,1,1,"ng-template",3),d.Yb()),2&e&&d.sc("columns",t.columns)("data",t.url)("event",d.vc(5,Re))("usePagination",!1)("tableAction",t.tableAction)},directives:[ie,k,C,b.a,m.a,E.a,y.a,I.a,D.l,Ie.a],styles:[""]}),He),Le=((Ye=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.messageService=n}return _createClass(e,[{key:"getOptions",value:function(){return this.http.get("/user/menu").pipe(Object(ke.a)((function(e){return _e(e.data,(function(e){return{title:e.text,key:e._id}}))})),Object(z.a)((function(){return Object(ce.a)([])})))}},{key:"assigningMenus",value:function(e){var t=this;return this.http.patch("/role/assigningMenus",e).pipe(Object(x.a)((function(e){t.messageService.success(e.message)})))}}]),e}()).\u0275fac=function(e){return new(e||Ye)(d.dc(f.r),d.dc(w.e))},Ye.\u0275prov=d.Pb({token:Ye,factory:Ye.\u0275fac,providedIn:"root"}),Ye),Be=((Ee=function(){function e(t,n,i){var a=this;_classCallCheck(this,e),this.http=t,this.modal=n,this.assignMenus=i,this._formData={menuIds:[]},this._role={},this.schema={properties:{menuIds:{type:"string",title:"\u83dc\u5355",ui:{spanLabel:2,spanControl:22,widget:"tree-select",checkable:!0,mode:"tags",placeholder:"\u8bf7\u9009\u62e9\u83dc\u5355",checkStrictly:!0,expandedKeys:[],asyncData:function(){return a.assignMenus.getOptions()}}}}}}return _createClass(e,[{key:"getMenuIds",value:function(e){var t=[];return function e(n){return n?(n.forEach((function(n){t.push(n._id),e(n.children)})),t):[]}(e),t}},{key:"save",value:function(e){var t=this;this.assignMenus.assigningMenus({roleId:this.role._id,menuIds:e.menuIds}).subscribe((function(e){t.close(e)})),console.log(e)}},{key:"close",value:function(e){this.modal.destroy(e)}},{key:"role",set:function(e){this._role=e,console.log(e),this._formData.menuIds=this.getMenuIds(e.menus),this.schema.properties.menuIds.ui.expandedKeys=this._formData.menuIds},get:function(){return this._role}}]),e}()).\u0275fac=function(e){return new(e||Ee)(d.Tb(f.r),d.Tb(h.b),d.Tb(Le))},Ee.\u0275cmp=d.Nb({type:Ee,selectors:[["app-role-assign-menus"]],inputs:{role:"role"},decls:10,vars:5,consts:[["nzTip","\u62fc\u547d\u52a0\u8f7d\u4e2d","nzSize","large",1,"modal-spin",3,"nzSpinning"],["mode","edit","button","none",3,"schema","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(e,t){if(1&e){var n=d.ac();d.Zb(0,"nz-spin",0),d.Zb(1,"sf",1,2),d.Zb(3,"div",3),d.Zb(4,"button",4),d.hc("click",(function(){return t.close()})),d.Oc(5,"\u5173\u95ed"),d.Yb(),d.Zb(6,"button",4),d.hc("click",(function(){return d.Ec(n),d.Bc(2).reset(!0)})),d.Oc(7,"\u91cd\u7f6e"),d.Yb(),d.Zb(8,"button",5),d.hc("click",(function(){d.Ec(n);var e=d.Bc(2);return t.save(e.value)})),d.Oc(9," \u4fdd\u5b58 "),d.Yb(),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.Bc(2);d.sc("nzSpinning",t.http.loading),d.Db(1),d.sc("schema",t.schema)("formData",t._formData),d.Db(7),d.sc("disabled",!i.valid)("nzLoading",t.http.loading)}},directives:[p.a,u.b,b.a,m.a,y.a],encapsulation:2}),Ee),Ue=n("nxWG"),Fe=["crud"];function qe(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",4),d.hc("click",(function(){d.Ec(n);var e=t.$implicit;return d.kc().assignMenus(e)})),d.Ub(1,"i",5),d.Oc(2,"\u5206\u914d\u83dc\u5355"),d.Yb()}if(2&e){var i=t.$implicit;d.sc("disabled",!i.checkbox||1!==i.checkbox.length)}}function Ne(e,t){if(1&e&&(d.Zb(0,"span",9),d.Ub(1,"i",10),d.Zb(2,"span",11),d.Oc(3),d.Yb(),d.Yb()),2&e){var n=t.$implicit,i=t.origin;d.Db(1),d.sc("nzType",n.isExpanded?"folder-open":"folder"),d.Db(2),d.Pc(i.text)}}function $e(e,t){1&e&&(d.Zb(0,"nz-tree",6,7),d.Mc(2,Ne,4,2,"ng-template",null,8,d.Nc),d.Yb()),2&e&&d.sc("nzData",t.$implicit.menus)}var Qe,Ge,We,Je=((Qe=function(){function e(t,n,i){var a=this;_classCallCheck(this,e),this.el=t,this.modal=n,this.messageService=i,this.url="/role/pagination",this.event={url:"/role",addAbility:"role_add",editAbility:"role_edit",delAbility:"role_del",options:{successCallback:function(){a.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:function(){console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:function(e){var t=e.columnData;return console.log(t),{url:"/role/"+t._id}}},del:{reData:function(e){var t=e.fromData;console.log(t);var n=[];return t instanceof Array?t.forEach((function(e){return n.push(e._id)})):n.push(t._id),{roleIds:n}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u521b\u5efa\u8005id",index:"creatorId",fromHidden:!0,show:!1},{title:"\u89d2\u8272\u540d",index:"name",required:!0},{title:"\u8bf4\u660e/\u63cf\u8ff0",index:"explanation"},{title:"\u83dc\u5355",render:"menus",fromHidden:!0,width:"auto"},{type:"date",index:"createdAt",title:"\u521b\u5efa\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0},{type:"date",index:"updatedAt",title:"\u66f4\u65b0\u65f6\u95f4",dateFormat:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm:ss",fromHidden:!0}],console.log(this,"UserComponent\u7684this")}return _createClass(e,[{key:"assignMenus",value:function(e){var t=this;this.modal.open(Be,{role:e.checkbox[0]},"md",{nzTitle:"\u5206\u914d\u83dc\u5355"}).subscribe((function(e){e&&t.crud.load()}))}},{key:"crudChange",value:function(e){console.log(e,"crudChange")}},{key:"ngAfterViewInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Qe)(d.Tb(d.l),d.Tb(f.j),d.Tb(w.e))},Qe.\u0275cmp=d.Nb({type:Qe,selectors:[["app-user"]],viewQuery:function(e,t){var n;1&e&&d.Tc(Fe,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},decls:4,vars:3,consts:[[3,"columns","data","event","change"],["crud",""],["crud-top-button",""],["crud-row","menus"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-icon","","nzType","menu","nzTheme","outline"],["nzShowIcon","",3,"nzData"],["nzTree",""],["nzTreeTemplate",""],[1,"custom-node"],["nz-icon","",1,"p-sm",3,"nzType"],[1,"folder-name"]],template:function(e,t){1&e&&(d.Zb(0,"app-crud",0,1),d.hc("change",(function(e){return t.crudChange(e)})),d.Mc(2,qe,3,1,"ng-template",2),d.Mc(3,$e,4,1,"ng-template",3),d.Yb()),2&e&&d.sc("columns",t.columns)("data",t.url)("event",t.event)},directives:[ie,k,C,b.a,m.a,y.a,I.a,Ue.a],encapsulation:2}),Qe),Ve=n("tyNb"),Xe=((We=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.messageService=n}return _createClass(e,[{key:"getOptions",value:function(){return this.http.get("/role/list").pipe(Object(ke.a)((function(e){return e.data.map((function(e){return{label:e.name,value:e._id}}))})),Object(z.a)((function(){return Object(ce.a)([])})))}},{key:"assigningRole",value:function(e){var t=this;return this.http.patch("/role/assigningRoles",e).pipe(Object(x.a)((function(e){t.messageService.success(e.message)})))}}]),e}()).\u0275fac=function(e){return new(e||We)(d.dc(f.r),d.dc(w.e))},We.\u0275prov=d.Pb({token:We,factory:We.\u0275fac,providedIn:"root"}),We),Ke=((Ge=function(){function e(t,n,i){var a=this;_classCallCheck(this,e),this.http=t,this.modal=n,this.drs=i,this._formData={roleIds:[]},this._user={},this.schema={properties:{roleIds:{type:"string",title:"\u89d2\u8272",ui:{spanLabel:2,spanControl:22,widget:"select",mode:"tags",placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272",asyncData:function(){return a.drs.getOptions()}}}}}}return _createClass(e,[{key:"save",value:function(e){var t=this;this.drs.assigningRole({userId:this.user._id,roleIds:e.roleIds}).subscribe((function(e){t.close(e)})),console.log(e)}},{key:"close",value:function(e){this.modal.destroy(e)}},{key:"user",set:function(e){this._user=e,console.log(e),this._formData.roleIds=e.roles.map((function(e){return e._id})),console.log(this._formData)},get:function(){return this._user}}]),e}()).\u0275fac=function(e){return new(e||Ge)(d.Tb(f.r),d.Tb(h.b),d.Tb(Xe))},Ge.\u0275cmp=d.Nb({type:Ge,selectors:[["app-user-designated-role"]],inputs:{user:"user"},decls:10,vars:5,consts:[["nzTip","\u62fc\u547d\u52a0\u8f7d\u4e2d","nzSize","large",1,"modal-spin",3,"nzSpinning"],["mode","edit","button","none",3,"schema","formData"],["sf",""],[1,"modal-footer"],["nz-button","","type","button",3,"click"],["nz-button","","type","submit","nzType","primary",3,"disabled","nzLoading","click"]],template:function(e,t){if(1&e){var n=d.ac();d.Zb(0,"nz-spin",0),d.Zb(1,"sf",1,2),d.Zb(3,"div",3),d.Zb(4,"button",4),d.hc("click",(function(){return t.close()})),d.Oc(5,"\u5173\u95ed"),d.Yb(),d.Zb(6,"button",4),d.hc("click",(function(){return d.Ec(n),d.Bc(2).reset(!0)})),d.Oc(7,"\u91cd\u7f6e"),d.Yb(),d.Zb(8,"button",5),d.hc("click",(function(){d.Ec(n);var e=d.Bc(2);return t.save(e.value)})),d.Oc(9," \u4fdd\u5b58 "),d.Yb(),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.Bc(2);d.sc("nzSpinning",t.http.loading),d.Db(1),d.sc("schema",t.schema)("formData",t._formData),d.Db(7),d.sc("disabled",!i.valid)("nzLoading",t.http.loading)}},directives:[p.a,u.b,b.a,m.a,y.a],encapsulation:2}),Ge),et=["crud"];function tt(e,t){if(1&e){var n=d.ac();d.Zb(0,"button",4),d.hc("click",(function(){d.Ec(n);var e=t.$implicit;return d.kc().designatedRole(e)})),d.Ub(1,"i",5),d.Oc(2,"\u6307\u5b9a\u89d2\u8272"),d.Yb()}if(2&e){var i=t.$implicit;d.sc("disabled",!i.checkbox||1!==i.checkbox.length)}}function nt(e,t){if(1&e&&(d.Xb(0),d.Zb(1,"nz-tag",7),d.Oc(2),d.Yb(),d.Wb()),2&e){var n=t.$implicit;d.Db(1),d.sc("nzColor","geekblue"),d.Db(1),d.Pc(n.name)}}function it(e,t){1&e&&d.Mc(0,nt,3,2,"ng-container",6),2&e&&d.sc("ngForOf",t.$implicit.roles)}var at,ct,rt,ot=[{path:"menu",canActivate:[E.b],data:{guard:{ability:["menu_read"]}},component:De},{path:"user",canActivate:[E.b],data:{guard:{ability:["user_read"]}},component:(at=function(){function e(t,n,i){var a=this;_classCallCheck(this,e),this.el=t,this.modal=n,this.messageService=i,this.url="/user/pagination",this.event={url:"/user",addAbility:"user_add",editAbility:"user_edit",delAbility:"user_del",options:{successCallback:function(){a.crud.load(),console.log("\u6210\u529f\u56de\u8c03")},errorCallback:function(){console.log("\u9519\u8bef\u56de\u8c03")}},edit:{reReq:function(e){var t=e.columnData;return console.log(t),{url:"/user/"+t._id}}},del:{reData:function(e){var t=e.fromData;console.log(t);var n=[];return t instanceof Array?t.forEach((function(e){return n.push(e._id)})):n.push(t._id),{userIds:n}}}},this.columns=[{title:"\u7f16\u53f7",type:"checkbox",width:60,fixed:"left",fromHidden:!0},{title:"_id",index:"_id",fromHidden:!0,show:!1},{title:"\u521b\u5efa\u8005id",index:"creatorId",fromHidden:!0,show:!1},{title:"\u6635\u79f0",index:"nickname",required:!0},{title:"\u7528\u6237\u540d",index:"username",required:!0},{title:"\u5bc6\u7801",index:"password",iif:function(){return!1},required:!0,fromEditHidden:!0,schema:{maxLength:11,minLength:6,ui:{type:"password"}}},{title:"\u624b\u673a\u53f7",index:"phoneNumber",schema:{type:"string",format:"mobile"}},{renderTitle:"roles",render:"roles",fromHidden:!0},{title:"\u5934\u50cf",type:"img",width:80,index:"avatar",schema:{ui:{widget:"upload",action:"/upload",resReName:"data.url",urlReName:"data.url",listType:"picture-card",limitFileCount:1,fileType:"image/png,image/jpeg,image/gif,image/bmp"}}},{title:"\u4e0a\u6b21\u767b\u5f55ip",index:"lastLoginIp",fromHidden:!0},{title:"\u4e0a\u6b21\u767b\u5f55\u65f6\u95f4",index:"lastLoginTime",fromHidden:!0},{title:"\u72b6\u6001",type:"yn",index:"status",yn:{yes:"\u542f\u7528",no:"\u7981\u7528"},schema:{type:"string",enum:[{label:"\u542f\u7528",value:!0},{label:"\u7981\u7528",value:!1}],ui:{widget:"radio"},default:!0}}],console.log(this,"UserComponent\u7684this")}return _createClass(e,[{key:"designatedRole",value:function(e){var t=this;this.modal.open(Ke,{user:e.checkbox[0]},"md",{nzTitle:"\u6307\u6d3e\u89d2\u8272"}).subscribe((function(e){e&&t.crud.load()}))}},{key:"crudChange",value:function(e){console.log(e,"crudChange")}},{key:"ngAfterViewInit",value:function(){}}]),e}(),at.\u0275fac=function(e){return new(e||at)(d.Tb(d.l),d.Tb(f.j),d.Tb(w.e))},at.\u0275cmp=d.Nb({type:at,selectors:[["app-user"]],viewQuery:function(e,t){var n;1&e&&d.Tc(et,!0),2&e&&d.Ac(n=d.ic())&&(t.crud=n.first)},decls:4,vars:3,consts:[[3,"columns","data","event","change"],["crud",""],["crud-top-button",""],["crud-row","roles"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-icon","","nzType","usergroup-add","nzTheme","outline"],[4,"ngFor","ngForOf"],[3,"nzColor"]],template:function(e,t){1&e&&(d.Zb(0,"app-crud",0,1),d.hc("change",(function(e){return t.crudChange(e)})),d.Mc(2,tt,3,1,"ng-template",2),d.Mc(3,it,1,1,"ng-template",3),d.Yb()),2&e&&d.sc("columns",t.columns)("data",t.url)("event",t.event)},directives:[ie,k,C,b.a,m.a,y.a,I.a,D.l,Ie.a],styles:[""]}),at)},{path:"logging",canActivate:[E.b],data:{guard:{ability:["logging_read"]}},component:ve},{path:"role",canActivate:[E.b],data:{guard:{ability:["role_read"]}},component:Je},{path:"dictionary",canActivate:[E.b],data:{guard:{ability:["dictionary_read"]}},component:fe},{path:"online",canActivate:[E.b],data:{guard:{ability:["user_online_read"]}},component:Pe}],st=((rt=function e(){_classCallCheck(this,e)}).\u0275mod=d.Rb({type:rt}),rt.\u0275inj=d.Qb({factory:function(e){return new(e||rt)},imports:[[Ve.m.forChild(ot)],Ve.m]}),rt),lt=((ct=function e(){_classCallCheck(this,e)}).\u0275mod=d.Rb({type:ct}),ct.\u0275inj=d.Qb({factory:function(e){return new(e||ct)},imports:[[st,ae]]}),ct)}}]);